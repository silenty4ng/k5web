import{d as A,g as C,_ as D}from"./index.97603514.js";import{a6 as O,P as N,d as P,k as x,a7 as V,O as $,U as R,_ as S}from"./@arco-design.95e0b031.js";import"./vue.24dcbee8.js";import{u as T}from"./vue-router.425aabc5.js";import{d as f,c as I,r as m,j as y,k as j,l as q,m as H}from"./serial.d615852e.js";import{d as M,h as U,l as L,o as z,a as G,x as i,u as r,e as c,z as _,A as b,D as F}from"./@vue.2faf1d8e.js";import"./vue-echarts.29561399.js";import"./resize-detector.a8854a64.js";import"./echarts.5b0e6023.js";import"./zrender.ce26131e.js";import"./tslib.c6ba9914.js";import"./nprogress.77f16b3e.js";import"./@intlify.b8ed1d74.js";import"./mitt.550594b0.js";import"./pinia.510425a1.js";import"./vue-demi.1e0b7689.js";import"./axios.234ce069.js";import"./vue-i18n.4b9acc8b.js";import"./@vueuse.c5c16882.js";import"./aegis-web-sdk.088ecaea.js";import"./@zxing.8654f0db.js";import"./tdesign-vue-next.62a9d0ce.js";import"./tdesign-icons-vue-next.514651cc.js";import"./sortablejs.b2e3c7c4.js";import"./@popperjs.f3f73334.js";import"./vue-matomo.ed94ba67.js";import"./b-tween.8dd4e2fe.js";import"./dayjs.08dc07e5.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";const W={class:"container"},J={style:{display:"flex","justify-content":"space-between","align-items":"center"}},K=["innerHTML"],Q={name:"Flash"},X=M({...Q,setup(Y){const p=A(),e=U({status:"\u70B9\u51FB\u66F4\u65B0\u6309\u94AE\u66F4\u65B0\u56FA\u4EF6\u5230\u8BBE\u5907<br/><br/>",binaryFile:void 0,binaryName:"",protocol:"Official"}),l=T();L(async()=>{var t;if(l.query.url){const a=await fetch(l.query.url),o=(t=a==null?void 0:a.body)==null?void 0:t.getReader();if(o){const s=[];for(;;){const{done:n,value:d}=await o.read();if(n)break;s.push(...d)}const u=new Uint8Array(s);e.binaryFile=u,e.binaryName=l.query.url.substring(l.query.url.lastIndexOf("/")+1).split("?")[0]+" "}}});const h=()=>{const t=document.createElement("input");t.type="file",t.onchange=async()=>{const a=new Blob([t.files[0]],{type:"application/octet-stream"}),o=new Uint8Array(await a.arrayBuffer());e.binaryFile=o,e.binaryName=t.files[0].name},t.click()},g=async()=>{if(!e.binaryFile){alert("\u8BF7\u9009\u62E9\u6587\u4EF6");return}p.connectPort&&await f(p.connectPort);let t=await I();e.protocol=="Official"&&await m(t,24,1e3),e.protocol=="Official"&&(await y(t,[48,5,16,0,42,79,69,70,87,45,76,79,83,69,72,85,0,0,0,0]),await m(t,24));const a=j(e.binaryFile);if(a.length>61440)throw alert("\u6700\u540E\u7684\u8FB9\u754C\u68C0\u67E5\u5931\u8D25\u3002\u4E0D\u7BA1\u662F\u8C01\u4FEE\u6539\u4E86\u4EE3\u7801\uFF0C\u4ED6\u90FD\u662F\u4E2A\u767D\u75F4\u3002"),new Error("Last resort boundary check failed. Whoever touched the code is an idiot.");for(let o=0;o<a.length;o+=256){const s=a.slice(o,o+256),u=q(s,o,a.length);try{await y(t,u),e.protocol=="Official"?await m(t,26):await H(t)}catch(n){return console.log("Flash command rejected. Aborting."),Promise.reject(n)}e.status=e.status+`\u66F4\u65B0\u8FDB\u5EA6 ${(o/a.length*100).toFixed(1)}%<br/>`,F(()=>{const n=document==null?void 0:document.getElementById("statusArea");n&&(n.scrollTop=n==null?void 0:n.scrollHeight)})}e.status=e.status+"\u66F4\u65B0\u8FDB\u5EA6 100.0%<br/>",e.status=e.status+"\u56FA\u4EF6\u66F4\u65B0\u6210\u529F",F(()=>{const o=document==null?void 0:document.getElementById("statusArea");o&&(o.scrollTop=o==null?void 0:o.scrollHeight)}),f(t),p.updateSettings({connectState:!1})};return(t,a)=>{const o=C,s=P,u=x,n=O,d=V,w=$,E=N,B=R,v=S;return z(),G("div",W,[i(o,{items:[t.$t("menu.list"),t.$t("menu.flash")]},null,8,["items"]),i(v,{gutter:20,align:"stretch"},{default:r(()=>[i(B,{span:24},{default:r(()=>[i(E,{class:"general-card",title:t.$t("menu.flash")+t.$t("global.onBoot")},{default:r(()=>[c("div",J,[c("div",null,[i(u,null,{default:r(()=>[i(s,{onClick:h},{default:r(()=>[_(b(e.binaryFile?e.binaryName:t.$t("tool.selectFirmware")),1)]),_:1}),i(s,{type:"primary",disabled:!e.binaryFile,onClick:g},{default:r(()=>[_(b(t.$t("tool.flash")),1)]),_:1},8,["disabled"])]),_:1})]),c("div",null,[i(d,{type:"button",size:"mini",modelValue:e.protocol,"onUpdate:modelValue":a[0]||(a[0]=k=>e.protocol=k)},{default:r(()=>[i(n,{value:"Official"},{default:r(()=>[_("Official")]),_:1})]),_:1},8,["modelValue"])])]),i(w),c("div",{id:"statusArea",style:{height:"20em","background-color":"var(--color-bg-3)",color:"var(--color-text-3)",overflow:"auto",padding:"20px"},innerHTML:e.status},null,8,K)]),_:1},8,["title"])]),_:1})]),_:1})])}}});const xt=D(X,[["__scopeId","data-v-f272bde7"]]);export{xt as default};
