import{d as oe,u as ae,g as ne,_ as se}from"./index.594063be.js";import{a2 as le,P as ie,M as B,U as re,_ as ue}from"./@arco-design.95e0b031.js";import"./vue.24dcbee8.js";import{b as de}from"./vue-router.425aabc5.js";import{a as _}from"./axios.234ce069.js";import{H as ce,K as pe,L as me,J as _e}from"./tdesign-icons-vue-next.514651cc.js";import{I as fe,B as ge,n as he,R as we,o as ve,P as ke,i as ye,L as xe,j as be,k as Fe,l as Ae,F as De,m as Ce,U as Ie,a as Ee}from"./tdesign-vue-next.62a9d0ce.js";import{d as $e,h as L,l as Ue,o as d,a as v,x as e,u as t,e as p,z as l,A as r,_ as c,F,Q as V,s as k,b9 as Be,b8 as Le}from"./@vue.2faf1d8e.js";import"./vue-echarts.29561399.js";import"./resize-detector.a8854a64.js";import"./echarts.5b0e6023.js";import"./zrender.ce26131e.js";import"./tslib.c6ba9914.js";import"./nprogress.77f16b3e.js";import"./@intlify.b8ed1d74.js";import"./mitt.550594b0.js";import"./pinia.510425a1.js";import"./vue-demi.1e0b7689.js";import"./vue-i18n.4b9acc8b.js";import"./@vueuse.c5c16882.js";import"./aegis-web-sdk.088ecaea.js";import"./@zxing.8654f0db.js";import"./vue-matomo.ed94ba67.js";import"./b-tween.8dd4e2fe.js";import"./dayjs.08dc07e5.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";import"./sortablejs.b2e3c7c4.js";import"./@popperjs.f3f73334.js";const Ve=y=>(Be("data-v-bc51700c"),y=y(),Le(),y),ze={class:"container"},Se={style:{display:"flex",gap:"1rem","align-items":"flex-end"}},Pe={style:{"margin-right":"20px"}},Re={style:{color:"#373737",margin:"10px"}},je={style:{display:"block",position:"absolute","background-color":"rgba(0, 0, 0, 0.3)","min-width":"80px",color:"white","padding-left":"10px","padding-right":"10px","font-size":"0.9rem"}},Te=["title","src"],Ne={style:{display:"flex","align-items":"center","justify-content":"space-between"}},qe={style:{display:"flex",width:"100%"}},Me={style:{width:"90%"}},He=Ve(()=>p("br",null,null,-1)),Je={style:{width:"40%",margin:"auto","text-align":"center"}},Ke={name:"Backup"},Oe=$e({...Ke,setup(y){oe();const u=ae(),z=de(),s=L({binaryFile:void 0,loading:!1,showPanel:!1,showUpload:!1,refLoading:!1,myList:[],total:0,page:1,nowpage:[],dropzoneActive:!1,title:""}),S=a=>{a.preventDefault(),s.dropzoneActive=!0},P=a=>{a.preventDefault(),s.dropzoneActive=!1},R=a=>{a.preventDefault()},j=async a=>{a.preventDefault(),s.dropzoneActive=!1;const n=a.dataTransfer.files;for(let g=0;g<n.length;g++){const h=new FormData;h.append("file",n[g]);let m=await _.post("https://k5ws.vicicode.cn/api/ajax/upload?server=1",h,{headers:{"ba-user-token":u.accountId}});await _.post("https://k5ws.vicicode.cn/api/image/add?server=1",{title:n[g].name,desc:"",image:m.data.file.url},{headers:{"ba-user-token":u.accountId}}),f()}},i=L({title:"",desc:"",firmware:[]});Ue(async()=>{A({current:1})});const A=async a=>{s.page=a.current;const n=await _.get("https://k5ws.vicicode.cn/api/image/index?server=1&limit=24&page="+a.current+"&title="+s.title+"&t="+Date.now());s.total=n.data.total,s.nowpage=n.data.list},f=async()=>{s.refLoading=!0,s.showPanel=!0;const a=await _.post("https://k5ws.vicicode.cn/api/image/my?server=1",{},{headers:{"ba-user-token":u.accountId}});s.myList=a.data,s.refLoading=!1},T=()=>{i.title="",i.desc="",i.firmware=[],s.showUpload=!0},N=async()=>{if(i.title==""||i.firmware.length==0){B.error({content:"\u672A\u586B\u5199\u540D\u79F0\u53CA\u4E0A\u4F20\u6587\u4EF6",duration:5*1e3});return}await _.post("https://k5ws.vicicode.cn/api/image/add?server=1",{title:i.title,desc:i.desc,data:i.firmware[0].response.data.file.url},{headers:{"ba-user-token":u.accountId}}),s.showUpload=!1,f()},q=async a=>{await _.post("https://k5ws.vicicode.cn/api/image/del?server=1",{id:a},{headers:{"ba-user-token":u.accountId}}),f()},M=async a=>{s.nowpage.filter(n=>{n.id==a&&(n.star+=1)}),await _.post("https://k5ws.vicicode.cn/api/image/star?server=1",{id:a}),B.success({content:"\u70B9\u8D5E\u6210\u529F",duration:5*1e3})},H=()=>{f()},J=a=>{z.push({path:"/tool/image",query:{url:a}})},D=()=>{A({current:1})};return(a,n)=>{const g=ne,h=fe,m=le,w=ge,C=he,K=we,O=ve,I=re,E=ue,Q=ke,G=ie,x=ye,W=xe,X=be,Y=Fe,$=Ae,b=De,Z=Ce,ee=Ie,te=Ee;return d(),v("div",ze,[e(g,{items:[a.$t("menu.workshop"),a.$t("menu.image")]},null,8,["items"]),e(E,{gutter:20,align:"stretch"},{default:t(()=>[e(I,{span:24},{default:t(()=>[e(G,{class:"general-card"},{title:t(()=>[p("div",Se,[l(r(a.$t("menu.image"))+" ",1),e(h,{size:"small",style:{width:"200px"},modelValue:s.title,"onUpdate:modelValue":n[0]||(n[0]=o=>s.title=o),onEnter:D},{suffixIcon:t(()=>[e(c(ce),{style:{cursor:"pointer"},onClick:D})]),_:1},8,["modelValue"])])]),extra:t(()=>[p("div",Pe,[c(u).name?(d(),v(F,{key:0},[e(m,{onClick:f},{default:t(()=>[l("\xA0\xA0"+r(c(u).name)+"\xA0\xA0",1)]),_:1}),e(m,{onClick:f},{default:t(()=>[l("\xA0\xA0"+r(a.$t("global.upload"))+"\xA0\xA0",1)]),_:1}),e(m,{onClick:n[1]||(n[1]=o=>c(u).logout())},{default:t(()=>[l("\xA0\xA0"+r(a.$t("global.logout"))+"\xA0\xA0",1)]),_:1})],64)):(d(),v(F,{key:1},[e(m,{onClick:n[2]||(n[2]=o=>c(u).setInfo({showLogin:!0}))},{default:t(()=>[l("\xA0\xA0"+r(a.$t("global.login"))+"\xA0\xA0",1)]),_:1}),e(m,{onClick:n[3]||(n[3]=o=>c(u).setInfo({showRegister:!0}))},{default:t(()=>[l("\xA0\xA0"+r(a.$t("global.register"))+"\xA0\xA0",1)]),_:1}),p("span",Re,r(a.$t("global.loginUpload")),1)],64))])]),default:t(()=>[e(E,{gutter:20},{default:t(()=>[(d(!0),v(F,null,V(s.nowpage,o=>(d(),k(I,{span:4},{default:t(()=>[e(O,{style:{width:"100%",marginBottom:"10px"}},{cover:t(()=>[p("div",je," \u70B9\u8D5E\uFF1A"+r(o.star),1),p("img",{style:{height:"6.75vw"},title:o.title+" ["+o.user.nickname+"]",src:"https://k5ws.vicicode.cn"+o.image},null,8,Te)]),footer:t(()=>[e(K,{align:"middle",justify:"center",style:{gap:"24px"}},{default:t(()=>[e(C,{flex:"auto",style:{display:"inline-flex","justify-content":"center"}},{default:t(()=>[e(w,{variant:"text",shape:"square",onClick:U=>M(o.id)},{default:t(()=>[e(c(pe))]),_:2},1032,["onClick"])]),_:2},1024),e(C,{flex:"auto",style:{display:"inline-flex","justify-content":"center"}},{default:t(()=>[e(w,{variant:"text",shape:"square",onClick:U=>J("https://k5ws.vicicode.cn"+o.image)},{default:t(()=>[e(c(me))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1}),e(Q,{onChange:A,style:{margin:"10px"},total:s.total,current:s.page,pageSize:24,showPageNumber:"",showPageSize:!1},null,8,["total","current"])]),_:1})]),_:1})]),_:1}),e($,{visible:s.showPanel,"onUpdate:visible":n[4]||(n[4]=o=>s.showPanel=o),size:"50%",header:"\u6211\u7684\u56FE\u7247",footer:!1,onDragenter:S,onDragleave:P,onDragover:R,onDrop:j},{default:t(()=>[p("div",Ne,[e(w,{style:{margin:"10px"},onClick:T},{default:t(()=>[l("\u4E0A\u4F20\u65B0\u56FE\u7247")]),_:1}),e(w,{loading:s.refLoading,shape:"circle",theme:"outline",onClick:H},{icon:t(()=>[e(c(_e))]),_:1},8,["loading"])]),e(Y,{split:!0},{default:t(()=>[(d(!0),v(F,null,V(s.myList,o=>(d(),k(X,null,{default:t(()=>[p("div",qe,[p("div",Me,[o.status==0?(d(),k(x,{key:0,theme:"primary",variant:"outline"},{default:t(()=>[l("\u5BA1\u6838\u4E2D"+r(o.remark&&`\uFF08${o.remark}\uFF09`),1)]),_:2},1024)):o.status==1?(d(),k(x,{key:1,theme:"primary",variant:"outline"},{default:t(()=>[l("\u5DF2\u5BA1\u6838"+r(o.remark&&`\uFF08${o.remark}\uFF09`),1)]),_:2},1024)):(d(),k(x,{key:2,theme:"primary",variant:"outline"},{default:t(()=>[l("\u5DF2\u9A73\u56DE"+r(o.remark&&`\uFF08${o.remark}\uFF09`),1)]),_:2},1024)),l(" "+r(o.title)+" ",1),He,l(" "+r(o.desc),1)]),p("div",Je,[e(x,null,{default:t(()=>[l(r(o.create_time_text),1)]),_:2},1024),l("\xA0 "),e(W,{theme:"primary",hover:"color",onClick:U=>q(o.id)},{default:t(()=>[l("\u5220\u9664")]),_:2},1032,["onClick"])])])]),_:2},1024))),256))]),_:1})]),_:1},8,["visible"]),e($,{visible:s.showUpload,"onUpdate:visible":n[8]||(n[8]=o=>s.showUpload=o),size:"25%",header:"\u4E0A\u4F20\u65B0\u56FE\u7247",footer:!1},{default:t(()=>[e(te,{data:i,"reset-type":"initial",colon:"",onSubmit:N},{default:t(()=>[e(b,{label:"\u56FE\u7247\u540D\u79F0",name:"title","label-align":"top"},{default:t(()=>[e(h,{modelValue:i.title,"onUpdate:modelValue":n[5]||(n[5]=o=>i.title=o)},null,8,["modelValue"])]),_:1}),e(b,{label:"\u56FE\u7247\u63CF\u8FF0",name:"desc","label-align":"top"},{default:t(()=>[e(Z,{autosize:{minRows:5,maxRows:10},modelValue:i.desc,"onUpdate:modelValue":n[6]||(n[6]=o=>i.desc=o),clearable:""},null,8,["modelValue"])]),_:1}),e(b,{label:"\u56FE\u7247\u6587\u4EF6",name:"firmware","label-align":"top"},{default:t(()=>[e(ee,{modelValue:i.firmware,"onUpdate:modelValue":n[7]||(n[7]=o=>i.firmware=o),action:"https://k5ws.vicicode.cn/api/ajax/upload?server=1","abridge-name":[8,6],headers:{"ba-user-token":c(u).accountId},theme:"file-input",placeholder:"\u672A\u9009\u62E9\u6587\u4EF6"},null,8,["modelValue","headers"])]),_:1}),e(b,{"label-align":"top"},{default:t(()=>[e(w,{theme:"primary",type:"submit",block:""},{default:t(()=>[l("\u63D0\u4EA4\u5BA1\u6838")]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])])}}});const Dt=se(Oe,[["__scopeId","data-v-bc51700c"]]);export{Dt as default};
