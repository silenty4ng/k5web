import{d as G,g as W,_ as X}from"./index.986328c2.js";import{ac as tt,ad as et,a8 as at,a2 as ot,a0 as st,P as nt,f as lt,a1 as rt,ab as it,d as ut,O as ct,U as dt,_ as pt}from"./@arco-design.95e0b031.js";import"./vue.24dcbee8.js";import{e as w,g as F,h as d,b as T,s as y}from"./serial.d615852e.js";import{u as mt}from"./loading.0f5749b3.js";import{I as A,c as I,B as ft,T as gt}from"./tdesign-vue-next.62a9d0ce.js";import{d as _t,r as h,h as St,c as bt,l as ht,m as wt,o as D,a as x,x as n,u as r,z as p,A as m,e as f,_ as yt,N as Dt,O as vt,F as Ft,Q as Tt,s as At,D as C,b9 as It,b8 as xt}from"./@vue.2faf1d8e.js";import"./vue-echarts.29561399.js";import"./resize-detector.a8854a64.js";import"./echarts.5b0e6023.js";import"./zrender.ce26131e.js";import"./tslib.c6ba9914.js";import"./vue-router.425aabc5.js";import"./nprogress.77f16b3e.js";import"./@intlify.b8ed1d74.js";import"./mitt.550594b0.js";import"./pinia.510425a1.js";import"./vue-demi.1e0b7689.js";import"./axios.234ce069.js";import"./vue-i18n.4b9acc8b.js";import"./@vueuse.c5c16882.js";import"./aegis-web-sdk.088ecaea.js";import"./@zxing.8654f0db.js";import"./vue-matomo.ed94ba67.js";import"./b-tween.8dd4e2fe.js";import"./dayjs.08dc07e5.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";import"./tdesign-icons-vue-next.514651cc.js";import"./sortablejs.b2e3c7c4.js";import"./@popperjs.f3f73334.js";const Ct=_=>(It("data-v-cec4bf24"),_=_(),xt(),_),Et={class:"container"},kt={style:{"text-align":"center"}},Bt=["src"],Ut=Ct(()=>f("br",null,null,-1)),Nt={style:{width:"100%"}},Ot=["innerHTML"],qt={name:"Sat"},Rt=_t({...qt,setup(_){const{loading:E,setLoading:g}=mt(!0),u=G();h(null),h(null),h(null);const e=St({uuid:"",qrcode:"",visible:!1,showHide:0,status:"\u70B9\u51FB\u5199\u5165\u6309\u94AE\u5199\u5165\u536B\u661F\u6570\u636E\u5230\u8BBE\u5907<br/><br/>",sat:"",satData:[],lng:0,lat:0,alt:0,tx:0,rx:0,txTone:0,rxTone:0,CTCSSOption:[0,67,69.3,71.9,74.4,77,79.7,82.5,85.4,88.5,91.5,94.8,97.4,100,103.5,107.2,110.9,114.8,118.8,123,127.3,131.8,136.5,141.3,146.2,151.4,156.7,159.8,162.2,165.5,167.9,171.3,173.8,177.3,179.9,183.5,186.2,189.9,192.8,196.6,199.5,203.5,206.5,210.7,218.1,225.7,229.1,233.6,241.8,250.3,254.1],pass:void 0,passOption:[],dt:"",timer:void 0,passCustom:void 0,dtCustom:void 0,freqDb:[],selfSatModal:!1,selfSatInfo:"",satsData:[]}),k=t=>{const{row:a}=t;return a.status!==2},B=h(),U=bt(()=>[{title:"\u536B\u661F\u540D\u79F0",colKey:"satName"},{title:"\u4E0A\u884C\u9891\u7387",colKey:"txFreq",align:"left",edit:{component:A,props:{clearable:!0,autofocus:!0},validateTrigger:"change",on:t=>({onBlur:()=>{console.log("\u5931\u53BB\u7126\u70B9",t)},onEnter:a=>{var o;(o=a==null?void 0:a.e)==null||o.preventDefault(),console.log("onEnter",a)}}),abortEditOnEvent:["onEnter"],onEdited:t=>{console.log(t);const a=[...e.satsData];a.splice(t.rowIndex,1,t.newRowData),e.satsData=a,console.log("Edit firstName:",t)},rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"}],defaultEditable:!0}},{title:"\u4E0A\u884C\u4E9A\u97F3",colKey:"txTone",edit:{component:I,props:{clearable:!0,options:e.CTCSSOption.map(t=>({label:t,value:t}))},on:t=>({onChange:a=>{console.log("status changed",t,a)}}),onEdited:t=>{e.satsData.splice(t.rowIndex,1,t.newRowData),console.log("Edit Framework:",t)}}},{title:"\u4E0B\u884C\u9891\u7387",colKey:"rxFreq",align:"left",edit:{component:A,props:{clearable:!0,autofocus:!0},validateTrigger:"change",on:t=>({onBlur:()=>{console.log("\u5931\u53BB\u7126\u70B9",t)},onEnter:a=>{var o;(o=a==null?void 0:a.e)==null||o.preventDefault(),console.log("onEnter",a)}}),abortEditOnEvent:["onEnter"],onEdited:t=>{console.log(t);const a=[...e.satsData];a.splice(t.rowIndex,1,t.newRowData),e.satsData=a,console.log("Edit firstName:",t)},rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"}],defaultEditable:!0}},{title:"\u4E0B\u884C\u4E9A\u97F3",colKey:"rxTone",edit:{component:I,props:{clearable:!0,options:e.CTCSSOption.map(t=>({label:t,value:t}))},on:t=>({onChange:a=>{console.log("status changed",t,a)}}),onEdited:t=>{e.satsData.splice(t.rowIndex,1,t.newRowData),console.log("Edit Framework:",t)}}}]);ht(async()=>{try{if(sessionStorage.getItem("satFrequenciesRst"))e.freqDb=JSON.parse(sessionStorage.getItem("satFrequenciesRst")||"[]");else{const t=await(await fetch("https://github.jobcher.com/gh/https://raw.githubusercontent.com/palewire/ham-satellite-database/main/data/amsat-active-frequencies.json")).text();e.freqDb=JSON.parse(t),sessionStorage.setItem("satFrequenciesRst",t)}}catch{}e.timer=setInterval(()=>{e.dt=new Date().toLocaleString(),localStorage.setItem("myLng",e.lng.toString()),localStorage.setItem("myLat",e.lat.toString()),localStorage.setItem("myAlt",e.alt.toString())},1e3)}),wt(()=>{try{clearInterval(e.timer)}catch{}});const N=async()=>{if(u.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}g(!0),await w(u.connectPort),await v(),await F(u.connectPort),g(!1)},v=async()=>{var o;const t=e.dtCustom?new Date(e.dtCustom):new Date,a=[...d(parseInt(t.getUTCFullYear().toString().substring(2,4)).toString(16)),...d((t.getUTCMonth()+1).toString(16)),...d(t.getUTCDate().toString(16)),...d(t.getUTCHours().toString(16)),...d(t.getUTCMinutes().toString(16)),...d(t.getUTCSeconds().toString(16))];await T(u.connectPort,11168,new Uint8Array(a),6,(o=u.configuration)==null?void 0:o.uart)},O=async t=>{const a=e.satData.find(o=>o.name==t);if(a&&a.path){e.status+="<br/>\u536B\u661F\u53C2\u6570\uFF1A<br/>",a.path.map(s=>{e.status+=s+"<br/>"});let o=!1;e.freqDb.map(s=>{a.path[1].split(" ")[1]==s.norad_id&&s.mode.indexOf("FM")!=-1&&(console.log(s),o=!0,e.tx=s.uplink?parseFloat(s.uplink.split("/")[0]):0,e.rx=s.downlink?parseFloat(s.downlink.split("/")[0]):0,e.txTone=parseFloat(e.CTCSSOption.reduce((l,c)=>s.mode.indexOf(c)!=-1?c:l)))}),o||(e.tx=0,e.rx=0,e.txTone=0,e.rxTone=0),e.satsData.push({satName:t,line:a.path,txFreq:e.tx,txTone:e.txTone,rxFreq:e.rx,rxTone:e.rxTone}),console.log(e.satsData)}C(()=>{const o=document==null?void 0:document.getElementById("statusArea");o&&(o.scrollTop=o==null?void 0:o.scrollHeight)})};(async()=>{g(!0);let t="";sessionStorage.getItem("satRst")?t=sessionStorage.getItem("satRst")||"":(t=await(await fetch("https://celestrak.org/NORAD/elements/amateur.txt")).text(),sessionStorage.setItem("satRst",t));const a=t.split(/\r?\n/),o=[];let s={};for(let l=0;l<a.length;l++)Number.isNaN(parseInt(a[l].substring(0,1)))?(s.name&&s.name!=""&&(o.push(s),s={}),s.name=a[l]):(s.path||(s.path=[]),s.path.push(a[l]));e.satData=o,g(!1)})();const q=async()=>{const t=await(await fetch("https://k5.vicicode.cn/api/lol",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({func:1,uuid:e.uuid})})).json(),a=JSON.parse(t.cache);a.length>=3&&(e.lng=a[0],e.lat=a[1],e.alt=a[2])},R=async(t=0,a)=>{var o;await w(u.connectPort);for(let s=t;s<a.length+t;s+=128)await T(u.connectPort,s,a.slice(s-t,s-t+128),128,(o=u.configuration)==null?void 0:o.uart),e.status=e.status+"\u5199\u5165\u8FDB\u5EA6\uFF1A"+((s-t)/a.length*100).toFixed(1)+"%<br/>",C(()=>{const l=document==null?void 0:document.getElementById("statusArea");l&&(l.scrollTop=l==null?void 0:l.scrollHeight)});e.status=e.status+"\u5199\u5165\u8FDB\u5EA6\uFF1A100.0%<br/>"},$=async()=>{var a;if(u.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}if(((a=u.configuration)==null?void 0:a.sat2)!=!0){alert(sessionStorage.getItem("noticeVersionNoSupport"));return}g(!0),await w(u.connectPort);let t=new Uint8Array(160*45);for(let o=0;o<e.satsData.length;o++){const s=e.satsData[o];t.set(y(s.satName).subarray(0,9),o*160),t.set(y(s.line[0]).subarray(0,69),o*160+9),t.set(y(s.line[1]).subarray(0,69),o*160+9+69);const l=new Uint8Array(2);s.txTone&&s.txTone>0&&l.set(d(parseInt((s.txTone*10).toFixed(0)).toString(16)).subarray(0,2)),t.set(l,o*160+9+69+69);const c=new Uint8Array(2);s.rxTone&&s.rxTone>0&&c.set(d(parseInt((s.rxTone*10).toFixed(0)).toString(16)).subarray(0,2)),t.set(c,o*160+9+69+69+2);const S=new Uint8Array(4);S.set(d(parseInt((s.txFreq*1e6/10).toFixed(0)).toString(16))),t.set(S,o*160+9+69+69+2+2);const b=new Uint8Array(4);b.set(d(parseInt((s.rxFreq*1e6/10).toFixed(0)).toString(16))),t.set(b,o*160+9+69+69+2+2+4)}await R(123392,t),await v(),await F(u.connectPort),g(!1)},V=t=>!!new RegExp("^(https?:\\/\\/)?((([a-zA-Z\\d]([a-zA-Z\\d-]*[a-zA-Z\\d])*)\\.)+[a-zA-Z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-zA-Z\\d%_.~+]*)*(\\?[;&a-zA-Z\\d%_.~+=-]*)?(\\#[-a-zA-Z\\d_]*)?$","i").test(t),M=async()=>{V(e.selfSatInfo)&&(e.selfSatInfo=await(await fetch(e.selfSatInfo)).text());const t=(e.selfSatInfo+`
`).split(/\r?\n/),a=[];let o={};for(let s=0;s<t.length;s++)Number.isNaN(parseInt(t[s].substring(0,1)))?(o.name&&o.name!=""&&(a.push(o),o={}),o.name=t[s]):(o.path||(o.path=[]),o.path.push(t[s]));e.satData=a.concat(e.satData),e.selfSatInfo=""};return(t,a)=>{const o=tt,s=lt,l=W,c=rt,S=et,b=ft,L=it,z=at,H=ot,P=gt,Z=ut,K=ct,Y=st,j=nt,J=dt,Q=pt;return D(),x("div",Et,[n(s,{width:"650px",visible:e.selfSatModal,"onUpdate:visible":a[1]||(a[1]=i=>e.selfSatModal=i),onOk:M},{title:r(()=>[p(m(t.$t("sat.selfSatInfo")),1)]),default:r(()=>[f("div",null,[n(o,{modelValue:e.selfSatInfo,"onUpdate:modelValue":a[0]||(a[0]=i=>e.selfSatInfo=i),style:{height:"120px"},placeholder:`ISS (ZARYA)             \r
  1 25544U 98067A   24320.36274227  .00015569  00000+0  28188-3 0  9999\r
  2 25544  51.6413 286.4173 0007936 217.3657 298.3197 15.49809951481990`},null,8,["modelValue"])])]),_:1},8,["visible"]),n(s,{visible:e.visible,"onUpdate:visible":a[2]||(a[2]=i=>e.visible=i),onOk:q,"ok-text":t.$t("tool.scaned")},{title:r(()=>[p(m(t.$t("tool.scanqr")),1)]),default:r(()=>[f("div",kt,[f("img",{src:e.qrcode},null,8,Bt),Ut,p(" "+m(t.$t("tool.scannotice")),1)])]),_:1},8,["visible","ok-text"]),n(l,{items:[t.$t("menu.list"),t.$t("menu.satellite2")]},null,8,["items"]),n(Q,{gutter:20,align:"stretch"},{default:r(()=>[n(J,{span:24},{default:r(()=>[n(j,{class:"general-card",title:t.$t("menu.satellite2")+t.$t("global.onStart")},{default:r(()=>[n(Y,{loading:yt(E),style:{width:"100%"},tip:"\u6B63\u5728\u5904\u7406 ..."},{default:r(()=>[n(c,{"label-col-style":{width:"25%"},field:"dt",label:t.$t("tool.brtime"),onClick:a[3]||(a[3]=()=>{e.showHide+=1})},{default:r(()=>[p(m(e.dt),1)]),_:1},8,["label"]),Dt(n(c,{"label-col-style":{width:"25%"},field:"dtCustom",label:"\u81EA\u5B9A\u4E49\u65F6\u95F4"},{default:r(()=>[f("div",null,[n(S,{style:{width:"220px",margin:"0 24px 24px 0"},"show-time":"","time-picker-props":{defaultValue:"00:00:00"},format:"YYYY-MM-DD HH:mm:ss",modelValue:e.dtCustom,"onUpdate:modelValue":a[4]||(a[4]=i=>e.dtCustom=i)},null,8,["modelValue"]),p(" \xA0\xA0"),n(b,{size:"small",theme:"success",onClick:N},{default:r(()=>[p("\u5199\u5165\u65F6\u95F4\u5230\u53F0\u7AD9")]),_:1})])]),_:1},512),[[vt,e.showHide>=5]]),n(c,{"label-col-style":{width:"25%"},field:"sat",label:t.$t("tool.selectSatellite")},{default:r(()=>[f("div",Nt,[n(z,{modelValue:e.sat,"onUpdate:modelValue":a[5]||(a[5]=i=>e.sat=i),onChange:O,placeholder:t.$t("tool.selectSatellite")+"...","allow-search":"","allow-clear":""},{default:r(()=>[(D(!0),x(Ft,null,Tt(e.satData,i=>(D(),At(L,{key:i.name,value:i.name},{default:r(()=>[p(m(i.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","placeholder"]),n(H,{onClick:a[6]||(a[6]=()=>{e.selfSatModal=!0}),style:{"margin-top":"10px"}},{default:r(()=>[p(m(t.$t("sat.addSelfSat")),1)]),_:1})])]),_:1},8,["label"]),n(c,{"label-col-style":{width:"25%"},field:"sat",label:""},{default:r(()=>[n(P,{ref_key:"tableRef",ref:B,"row-key":"key",columns:U.value,data:e.satsData,"editable-cell-state":k,bordered:"","lazy-load":""},null,8,["columns","data"])]),_:1}),n(c,{"label-col-style":{width:"25%"},label:""},{default:r(()=>[n(Z,{type:"primary",onClick:$},{default:r(()=>[p(m(t.$t("tool.writeData")),1)]),_:1})]),_:1}),n(K),f("div",{id:"statusArea",style:{height:"20em","background-color":"var(--color-bg-3)",color:"var(--color-text-3)",overflow:"auto",padding:"20px"},innerHTML:e.status},null,8,Ot)]),_:1},8,["loading"])]),_:1},8,["title"])]),_:1})]),_:1})])}}});const he=X(Rt,[["__scopeId","data-v-cec4bf24"]]);export{he as default};
