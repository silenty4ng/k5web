import{d as Z,u as ee,g as te,_ as oe}from"./index.d0c6cd70.js";import{a4 as ae,a5 as ne,U as se,M as E,a6 as le,a7 as ie,W as re,a0 as ue}from"./@arco-design.282d06c8.js";import"./vue.ffb667bf.js";import{b as de}from"./vue-router.a9f5d186.js";import{a as w}from"./axios.06033baf.js";import{J as ce,K as pe}from"./tdesign-icons-vue-next.f086fa1d.js";import{I as me,i as _e,P as fe,B as we,L as ge,j as he,k as ke,l as ye,F as ve,m as xe,U as Fe,a as be}from"./tdesign-vue-next.d1c1adb1.js";import{d as Ae,h as U,l as Ce,o as c,a as k,x as a,u as o,b as p,z as i,A as r,_ as m,F,Q as B,s as y}from"./@vue.6ceb3fa6.js";import"./nprogress.6328d444.js";import"./@intlify.02b6985d.js";import"./mitt.550594b0.js";import"./pinia.fa8b6be2.js";import"./vue-demi.0e7683c7.js";import"./vue-i18n.5fb6db72.js";import"./@vueuse.a7db99fe.js";import"./@zxing.8654f0db.js";import"./vue-matomo.5bdfe9a5.js";import"./b-tween.8dd4e2fe.js";import"./dayjs.35d19ede.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";import"./lodash-es.18922ecc.js";import"./sortablejs.77296005.js";import"./@popperjs.f3f73334.js";import"./@babel.9b6013fe.js";const $e={class:"container"},Le={style:{display:"flex",gap:"1rem","align-items":"flex-end"}},Ee={style:{"margin-right":"20px"}},Ue={style:{color:"#373737",margin:"10px"}},Be={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Ie={style:{display:"flex",width:"100%"}},De={style:{width:"90%"}},Ve={style:{width:"50%",margin:"auto","text-align":"center"}},Pe={name:"Backup"},Se=Ae({...Pe,setup(Re){Z();const d=ee(),I=de(),s=U({binaryFile:void 0,loading:!1,showPanel:!1,showUpload:!1,refLoading:!1,myList:[],total:0,page:1,nowpage:[],title:""}),l=U({id:0,title:"",desc:"",firmware:[]});Ce(async()=>{b({current:1})});const b=async n=>{s.page=n.current;const e=await w.get("https://k5ws.vicicode.cn/api/channel/index?server=1&limit=12&page="+n.current+"&title="+s.title+"&t="+Date.now());s.total=e.data.total,s.nowpage=e.data.list},g=async()=>{s.refLoading=!0,s.showPanel=!0;const n=await w.post("https://k5ws.vicicode.cn/api/channel/my?server=1",{},{headers:{"ba-user-token":d.accountId}});s.myList=n.data,s.refLoading=!1},D=()=>{l.id=0,l.title="",l.desc="",l.firmware=[],s.showUpload=!0},V=async()=>{var n;if(l.title==""||l.firmware.code==0){E.error({content:"\u672A\u586B\u5199\u540D\u79F0\u53CA\u4E0A\u4F20\u6587\u4EF6",duration:5*1e3});return}l.id===0?await w.post("https://k5ws.vicicode.cn/api/channel/add?server=1",{title:l.title,desc:l.desc,data:l.firmware[0].response.data.file.url},{headers:{"ba-user-token":d.accountId}}):await w.post("https://k5ws.vicicode.cn/api/channel/edit?server=1",{id:l.id,title:l.title,desc:l.desc,data:(n=l.firmware[0].url)!=null?n:l.firmware[0].response.data.file.url},{headers:{"ba-user-token":d.accountId}}),s.showUpload=!1,g()},P=async n=>{l.id=n,l.title=s.myList.filter(e=>e.id==n)[0].title,l.desc=s.myList.filter(e=>e.id==n)[0].desc,l.firmware=[{name:s.myList.filter(e=>e.id==n)[0].title,status:"success",url:s.myList.filter(e=>e.id==n)[0].file}],s.showUpload=!0},S=async n=>{await w.post("https://k5ws.vicicode.cn/api/channel/del?server=1",{id:n},{headers:{"ba-user-token":d.accountId}}),g()},R=async n=>{s.nowpage.filter(e=>{e.id==n&&(e.star+=1)}),await w.post("https://k5ws.vicicode.cn/api/channel/star?server=1",{id:n}),E.success({content:"\u70B9\u8D5E\u6210\u529F",duration:5*1e3})},z=()=>{g()},T=n=>{I.push({path:"/chirp/channel",query:{url:n}})},j=(n,e)=>{fetch(n).then(h=>h.blob()).then(h=>{const v=URL.createObjectURL(h),u=document.createElement("a");u.href=v,u.download=e+".xlsx",document.body.appendChild(u),u.click(),document.body.removeChild(u)})},C=()=>{b({current:1})};return(n,e)=>{const h=te,v=me,u=ae,f=_e,M=le,N=ie,q=ne,J=fe,K=se,O=re,Q=ue,A=we,$=ge,W=he,G=ke,L=ye,x=ve,H=xe,X=Fe,Y=be;return c(),k("div",$e,[a(h,{items:[n.$t("menu.workshop"),n.$t("menu.channel")]},null,8,["items"]),a(Q,{gutter:20,align:"stretch"},{default:o(()=>[a(O,{span:24},{default:o(()=>[a(K,{class:"general-card"},{title:o(()=>[p("div",Le,[i(r(n.$t("menu.channel"))+" ",1),a(v,{size:"small",style:{width:"200px"},modelValue:s.title,"onUpdate:modelValue":e[0]||(e[0]=t=>s.title=t),onEnter:C},{suffixIcon:o(()=>[a(m(ce),{style:{cursor:"pointer"},onClick:C})]),_:1},8,["modelValue"])])]),extra:o(()=>[p("div",Ee,[m(d).name?(c(),k(F,{key:0},[a(u,{onClick:g},{default:o(()=>[i("\xA0\xA0"+r(m(d).name)+"\xA0\xA0",1)]),_:1}),a(u,{onClick:g},{default:o(()=>[i("\xA0\xA0"+r(n.$t("global.upload"))+"\xA0\xA0",1)]),_:1}),a(u,{onClick:e[1]||(e[1]=t=>m(d).logout())},{default:o(()=>[i("\xA0\xA0"+r(n.$t("global.logout"))+"\xA0\xA0",1)]),_:1})],64)):(c(),k(F,{key:1},[a(u,{onClick:e[2]||(e[2]=t=>m(d).setInfo({showLogin:!0}))},{default:o(()=>[i("\xA0\xA0"+r(n.$t("global.login"))+"\xA0\xA0",1)]),_:1}),a(u,{onClick:e[3]||(e[3]=t=>m(d).setInfo({showRegister:!0}))},{default:o(()=>[i("\xA0\xA0"+r(n.$t("global.register"))+"\xA0\xA0",1)]),_:1}),p("span",Ue,r(n.$t("global.loginUpload")),1)],64))])]),default:o(()=>[a(q,null,{default:o(()=>[(c(!0),k(F,null,B(s.nowpage,t=>(c(),y(N,{style:{width:"100%"}},{actions:o(()=>[a(f,{style:{"margin-left":"1rem"}},{default:o(()=>[i(r(t.create_time_text),1)]),_:2},1024),a(u,{style:{"min-width":"100px"},onClick:_=>R(t.id)},{default:o(()=>[i("\u{1F44D}\uFF08"+r(t.star)+"\uFF09",1)]),_:2},1032,["onClick"]),a(u,{style:{"min-width":"70px"},onClick:_=>j("https://k5ws.vicicode.cn"+t.file,t.title)},{default:o(()=>[i(r(n.$t("global.download")),1)]),_:1},8,["onClick"]),a(u,{style:{"min-width":"70px"},onClick:_=>T("https://k5ws.vicicode.cn"+t.file)},{default:o(()=>[i(r(n.$t("global.use")),1)]),_:1},8,["onClick"])]),default:o(()=>[a(M,{description:t.desc},{title:o(()=>[a(f,{theme:"primary",variant:"outline"},{default:o(()=>{var _;return[i(r((_=t.user)==null?void 0:_.nickname),1)]}),_:2},1024),i(" "+r(t.title),1)]),_:2},1032,["description"])]),_:2},1024))),256))]),_:1}),a(J,{onChange:b,style:{margin:"10px"},total:s.total,current:s.page,pageSize:12,showPageNumber:"",showPageSize:!1},null,8,["total","current"])]),_:1})]),_:1})]),_:1}),a(L,{visible:s.showPanel,"onUpdate:visible":e[4]||(e[4]=t=>s.showPanel=t),size:"50%",header:"\u6211\u7684\u5206\u4EAB",footer:!1},{default:o(()=>[p("div",Be,[a(A,{style:{margin:"10px"},onClick:D},{default:o(()=>[...e[9]||(e[9]=[i("\u4E0A\u4F20\u65B0\u5206\u4EAB",-1)])]),_:1}),a(A,{loading:s.refLoading,shape:"circle",theme:"outline",onClick:z},{icon:o(()=>[a(m(pe))]),_:1},8,["loading"])]),a(G,{split:!0},{default:o(()=>[(c(!0),k(F,null,B(s.myList,t=>(c(),y(W,null,{default:o(()=>[p("div",Ie,[p("div",De,[t.status==0?(c(),y(f,{key:0,theme:"primary",variant:"outline"},{default:o(()=>[i("\u5BA1\u6838\u4E2D"+r(t.remark&&`\uFF08${t.remark}\uFF09`),1)]),_:2},1024)):t.status==1?(c(),y(f,{key:1,theme:"primary",variant:"outline"},{default:o(()=>[i("\u5DF2\u5BA1\u6838"+r(t.remark&&`\uFF08${t.remark}\uFF09`),1)]),_:2},1024)):(c(),y(f,{key:2,theme:"primary",variant:"outline"},{default:o(()=>[i("\u5DF2\u9A73\u56DE"+r(t.remark&&`\uFF08${t.remark}\uFF09`),1)]),_:2},1024)),i(" "+r(t.title)+" ",1),e[10]||(e[10]=p("br",null,null,-1)),i(" "+r(t.desc),1)]),p("div",Ve,[a(f,null,{default:o(()=>[i(r(t.create_time_text),1)]),_:2},1024),e[13]||(e[13]=i("\xA0 ",-1)),a($,{theme:"primary",hover:"color",onClick:_=>P(t.id)},{default:o(()=>[...e[11]||(e[11]=[i("\u7F16\u8F91",-1)])]),_:1},8,["onClick"]),e[14]||(e[14]=i("\xA0 ",-1)),a($,{theme:"primary",hover:"color",onClick:_=>S(t.id)},{default:o(()=>[...e[12]||(e[12]=[i("\u5220\u9664",-1)])]),_:1},8,["onClick"])])])]),_:2},1024))),256))]),_:1})]),_:1},8,["visible"]),a(L,{visible:s.showUpload,"onUpdate:visible":e[8]||(e[8]=t=>s.showUpload=t),size:"25%",header:"\u4E0A\u4F20\u65B0\u56FA\u4EF6",footer:!1},{default:o(()=>[a(Y,{data:l,"reset-type":"initial",colon:"",onSubmit:V},{default:o(()=>[a(x,{label:"\u5206\u4EAB\u540D\u79F0",name:"title","label-align":"top"},{default:o(()=>[a(v,{modelValue:l.title,"onUpdate:modelValue":e[5]||(e[5]=t=>l.title=t)},null,8,["modelValue"])]),_:1}),a(x,{label:"\u5206\u4EAB\u63CF\u8FF0",name:"desc","label-align":"top"},{default:o(()=>[a(H,{maxlength:200,autosize:{minRows:5,maxRows:10},modelValue:l.desc,"onUpdate:modelValue":e[6]||(e[6]=t=>l.desc=t),clearable:""},null,8,["modelValue"])]),_:1}),a(x,{label:"\u4FE1\u9053\u6587\u4EF6",name:"firmware","label-align":"top"},{default:o(()=>[a(X,{modelValue:l.firmware,"onUpdate:modelValue":e[7]||(e[7]=t=>l.firmware=t),action:"https://k5ws.vicicode.cn/api/ajax/upload?server=1","abridge-name":[8,6],headers:{"ba-user-token":m(d).accountId},theme:"file-input",placeholder:"\u672A\u9009\u62E9\u6587\u4EF6"},null,8,["modelValue","headers"])]),_:1}),a(x,{"label-align":"top"},{default:o(()=>[a(A,{theme:"primary",type:"submit",block:""},{default:o(()=>[...e[15]||(e[15]=[i("\u63D0\u4EA4\u5BA1\u6838",-1)])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])])}}});const pt=oe(Se,[["__scopeId","data-v-af982f8c"]]);export{pt as default};
