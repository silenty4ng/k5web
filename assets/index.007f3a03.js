import{d as A,g as C,_ as D}from"./index.a1ade083.js";import{U as N,d as O,k as P,R as x,n as R,P as V,W as $,a0 as S}from"./@arco-design.1f9a81c2.js";import"./vue.daf89c07.js";import{u as T}from"./vue-router.391082ef.js";import{d as _,c as I,r as m,j as y,k as j,l as q,m as H}from"./serial.0b46e76d.js";import{d as M,h as U,l as L,o as z,a as W,x as i,u as r,e as c,z as f,A as b,D as F}from"./@vue.1cdd4af7.js";import"./nprogress.b0a22fe3.js";import"./@intlify.d4358f23.js";import"./mitt.550594b0.js";import"./pinia.722f5e0f.js";import"./vue-demi.0f54e832.js";import"./axios.f3f20840.js";import"./vue-i18n.645f4f0b.js";import"./tdesign-vue-next.876353e4.js";import"./lodash-es.18922ecc.js";import"./tdesign-icons-vue-next.5ef165be.js";import"./sortablejs.b2e3c7c4.js";import"./@popperjs.f3f73334.js";import"./@babel.9b6013fe.js";import"./dayjs.f7934723.js";import"./@vueuse.3623d212.js";import"./aegis-web-sdk.846094f8.js";import"./@zxing.8654f0db.js";import"./vue-matomo.4c7efa96.js";import"./b-tween.8dd4e2fe.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";const G={class:"container"},J={style:{display:"flex","justify-content":"space-between","align-items":"center"}},K=["innerHTML"],Q={name:"Flash"},X=M({...Q,setup(Y){const d=A(),e=U({status:"\u70B9\u51FB\u66F4\u65B0\u6309\u94AE\u66F4\u65B0\u56FA\u4EF6\u5230\u8BBE\u5907<br/><br/>",binaryFile:void 0,binaryName:"",protocol:"Official"}),l=T();L(async()=>{var t;if(l.query.url){const a=await fetch(l.query.url),o=(t=a==null?void 0:a.body)==null?void 0:t.getReader();if(o){const s=[];for(;;){const{done:n,value:p}=await o.read();if(n)break;s.push(...p)}const u=new Uint8Array(s);e.binaryFile=u,e.binaryName=l.query.url.substring(l.query.url.lastIndexOf("/")+1).split("?")[0]+" "}}});const h=()=>{const t=document.createElement("input");t.type="file",t.onchange=async()=>{const a=new Blob([t.files[0]],{type:"application/octet-stream"}),o=new Uint8Array(await a.arrayBuffer());e.binaryFile=o,e.binaryName=t.files[0].name},t.click()},g=async()=>{if(!e.binaryFile){alert("\u8BF7\u9009\u62E9\u6587\u4EF6");return}d.connectPort&&await _(d.connectPort);let t=await I();e.protocol=="Official"&&await m(t,24,1e3),e.protocol=="Official"&&(await y(t,[48,5,16,0,42,79,69,70,87,45,76,79,83,69,72,85,0,0,0,0]),await m(t,24));const a=j(e.binaryFile);if(a.length>61440)throw alert("\u6700\u540E\u7684\u8FB9\u754C\u68C0\u67E5\u5931\u8D25\u3002\u4E0D\u7BA1\u662F\u8C01\u4FEE\u6539\u4E86\u4EE3\u7801\uFF0C\u4ED6\u90FD\u662F\u4E2A\u767D\u75F4\u3002"),new Error("Last resort boundary check failed. Whoever touched the code is an idiot.");for(let o=0;o<a.length;o+=256){const s=a.slice(o,o+256),u=q(s,o,a.length);try{await y(t,u),e.protocol=="Official"?await m(t,26):await H(t)}catch(n){return console.log("Flash command rejected. Aborting."),Promise.reject(n)}e.status=e.status+`\u66F4\u65B0\u8FDB\u5EA6 ${(o/a.length*100).toFixed(1)}%<br/>`,F(()=>{const n=document==null?void 0:document.getElementById("statusArea");n&&(n.scrollTop=n==null?void 0:n.scrollHeight)})}e.status=e.status+"\u66F4\u65B0\u8FDB\u5EA6 100.0%<br/>",e.status=e.status+"\u56FA\u4EF6\u66F4\u65B0\u6210\u529F",F(()=>{const o=document==null?void 0:document.getElementById("statusArea");o&&(o.scrollTop=o==null?void 0:o.scrollHeight)}),_(t),d.updateSettings({connectState:!1})};return(t,a)=>{const o=C,s=O,u=P,n=x,p=R,w=V,E=N,B=$,v=S;return z(),W("div",G,[i(o,{items:[t.$t("menu.list"),t.$t("menu.flash")]},null,8,["items"]),i(v,{gutter:20,align:"stretch"},{default:r(()=>[i(B,{span:24},{default:r(()=>[i(E,{class:"general-card",title:t.$t("menu.flash")+t.$t("global.onBoot")},{default:r(()=>[c("div",J,[c("div",null,[i(u,null,{default:r(()=>[i(s,{onClick:h},{default:r(()=>[f(b(e.binaryFile?e.binaryName:t.$t("tool.selectFirmware")),1)]),_:1}),i(s,{type:"primary",disabled:!e.binaryFile,onClick:g},{default:r(()=>[f(b(t.$t("tool.flash")),1)]),_:1},8,["disabled"])]),_:1})]),c("div",null,[i(p,{type:"button",size:"mini",modelValue:e.protocol,"onUpdate:modelValue":a[0]||(a[0]=k=>e.protocol=k)},{default:r(()=>[i(n,{value:"Official"},{default:r(()=>[f("Official")]),_:1})]),_:1},8,["modelValue"])])]),i(w),c("div",{id:"statusArea",style:{height:"20em","background-color":"var(--color-bg-3)",color:"var(--color-text-3)",overflow:"auto",padding:"20px"},innerHTML:e.status},null,8,K)]),_:1},8,["title"])]),_:1})]),_:1})])}}});const Nt=D(X,[["__scopeId","data-v-f272bde7"]]);export{Nt as default};
