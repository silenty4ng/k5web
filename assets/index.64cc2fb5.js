import{d as te,u as oe,g as ae,_ as ne}from"./index.c45d42f7.js";import{a2 as se,P as le,M as U,U as ie,_ as re}from"./@arco-design.10d71e42.js";import"./vue.ffb667bf.js";import{b as ue}from"./vue-router.a9f5d186.js";import{a as _}from"./axios.06033baf.js";import{S as de,T as pe,C as ce,R as me}from"./tdesign-icons-vue-next.a5366875.js";import{I as _e,B as fe,n as ge,R as we,o as ve,P as ke,i as ye,L as he,j as xe,k as be,l as Fe,F as Ae,m as Ce,U as De,a as Ee}from"./tdesign-vue-next.ed813ef2.js";import{d as $e,h as B,l as Ie,o as d,a as k,x as t,u as o,b as p,z as l,A as r,_ as c,F as b,Q as L,s as y}from"./@vue.6ceb3fa6.js";import"./nprogress.6328d444.js";import"./@intlify.02b6985d.js";import"./mitt.550594b0.js";import"./pinia.fa8b6be2.js";import"./vue-demi.0e7683c7.js";import"./vue-i18n.5fb6db72.js";import"./@vueuse.a7db99fe.js";import"./@zxing.8654f0db.js";import"./@microsoft.d2aaf3b7.js";import"./vue-matomo.5bdfe9a5.js";import"./b-tween.8dd4e2fe.js";import"./dayjs.35d19ede.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";import"./lodash-es.18922ecc.js";import"./sortablejs.77296005.js";import"./@popperjs.f3f73334.js";import"./@babel.9b6013fe.js";const Ue={class:"container"},Be={style:{display:"flex",gap:"1rem","align-items":"flex-end"}},Le={style:{"margin-right":"20px"}},Ve={style:{color:"#373737",margin:"10px"}},ze={style:{display:"block",position:"absolute","background-color":"rgba(0, 0, 0, 0.3)","min-width":"80px",color:"white","padding-left":"10px","padding-right":"10px","font-size":"0.9rem"}},Pe=["title","src"],Se={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Re={style:{display:"flex",width:"100%"}},je={style:{width:"90%"}},Te={style:{width:"40%",margin:"auto","text-align":"center"}},Ne={name:"Backup"},qe=$e({...Ne,setup(Me){te();const u=oe(),V=ue(),s=B({binaryFile:void 0,loading:!1,showPanel:!1,showUpload:!1,refLoading:!1,myList:[],total:0,page:1,nowpage:[],dropzoneActive:!1,title:""}),z=n=>{n.preventDefault(),s.dropzoneActive=!0},P=n=>{n.preventDefault(),s.dropzoneActive=!1},S=n=>{n.preventDefault()},R=async n=>{n.preventDefault(),s.dropzoneActive=!1;const e=n.dataTransfer.files;for(let g=0;g<e.length;g++){const w=new FormData;w.append("file",e[g]);let m=await _.post("https://k5ws.vicicode.cn/api/ajax/upload?server=1",w,{headers:{"ba-user-token":u.accountId}});await _.post("https://k5ws.vicicode.cn/api/image/add?server=1",{title:e[g].name,desc:"",image:m.data.file.url},{headers:{"ba-user-token":u.accountId}}),f()}},i=B({title:"",desc:"",firmware:[]});Ie(async()=>{F({current:1})});const F=async n=>{s.page=n.current;const e=await _.get("https://k5ws.vicicode.cn/api/image/index?server=1&limit=24&page="+n.current+"&title="+s.title+"&t="+Date.now());s.total=e.data.total,s.nowpage=e.data.list},f=async()=>{s.refLoading=!0,s.showPanel=!0;const n=await _.post("https://k5ws.vicicode.cn/api/image/my?server=1",{},{headers:{"ba-user-token":u.accountId}});s.myList=n.data,s.refLoading=!1},j=()=>{i.title="",i.desc="",i.firmware=[],s.showUpload=!0},T=async()=>{if(i.title==""||i.firmware.length==0){U.error({content:"\u672A\u586B\u5199\u540D\u79F0\u53CA\u4E0A\u4F20\u6587\u4EF6",duration:5*1e3});return}await _.post("https://k5ws.vicicode.cn/api/image/add?server=1",{title:i.title,desc:i.desc,data:i.firmware[0].response.data.file.url},{headers:{"ba-user-token":u.accountId}}),s.showUpload=!1,f()},N=async n=>{await _.post("https://k5ws.vicicode.cn/api/image/del?server=1",{id:n},{headers:{"ba-user-token":u.accountId}}),f()},q=async n=>{s.nowpage.filter(e=>{e.id==n&&(e.star+=1)}),await _.post("https://k5ws.vicicode.cn/api/image/star?server=1",{id:n}),U.success({content:"\u70B9\u8D5E\u6210\u529F",duration:5*1e3})},M=()=>{f()},O=n=>{V.push({path:"/tool/image",query:{url:n}})},A=()=>{F({current:1})};return(n,e)=>{const g=ae,w=_e,m=se,v=fe,C=ge,Q=we,G=ve,D=ie,E=re,H=ke,J=le,h=ye,K=he,W=xe,X=be,$=Fe,x=Ae,Y=Ce,Z=De,ee=Ee;return d(),k("div",Ue,[t(g,{items:[n.$t("menu.workshop"),n.$t("menu.image")]},null,8,["items"]),t(E,{gutter:20,align:"stretch"},{default:o(()=>[t(D,{span:24},{default:o(()=>[t(J,{class:"general-card"},{title:o(()=>[p("div",Be,[l(r(n.$t("menu.image"))+" ",1),t(w,{size:"small",style:{width:"200px"},modelValue:s.title,"onUpdate:modelValue":e[0]||(e[0]=a=>s.title=a),onEnter:A},{suffixIcon:o(()=>[t(c(de),{style:{cursor:"pointer"},onClick:A})]),_:1},8,["modelValue"])])]),extra:o(()=>[p("div",Le,[c(u).name?(d(),k(b,{key:0},[t(m,{onClick:f},{default:o(()=>[l("\xA0\xA0"+r(c(u).name)+"\xA0\xA0",1)]),_:1}),t(m,{onClick:f},{default:o(()=>[l("\xA0\xA0"+r(n.$t("global.upload"))+"\xA0\xA0",1)]),_:1}),t(m,{onClick:e[1]||(e[1]=a=>c(u).logout())},{default:o(()=>[l("\xA0\xA0"+r(n.$t("global.logout"))+"\xA0\xA0",1)]),_:1})],64)):(d(),k(b,{key:1},[t(m,{onClick:e[2]||(e[2]=a=>c(u).setInfo({showLogin:!0}))},{default:o(()=>[l("\xA0\xA0"+r(n.$t("global.login"))+"\xA0\xA0",1)]),_:1}),t(m,{onClick:e[3]||(e[3]=a=>c(u).setInfo({showRegister:!0}))},{default:o(()=>[l("\xA0\xA0"+r(n.$t("global.register"))+"\xA0\xA0",1)]),_:1}),p("span",Ve,r(n.$t("global.loginUpload")),1)],64))])]),default:o(()=>[t(E,{gutter:20},{default:o(()=>[(d(!0),k(b,null,L(s.nowpage,a=>(d(),y(D,{span:4},{default:o(()=>[t(G,{style:{width:"100%",marginBottom:"10px"}},{cover:o(()=>[p("div",ze," \u70B9\u8D5E\uFF1A"+r(a.star),1),p("img",{style:{height:"6.75vw"},title:a.title+" ["+a.user.nickname+"]",src:"https://k5ws.vicicode.cn"+a.image},null,8,Pe)]),footer:o(()=>[t(Q,{align:"middle",justify:"center",style:{gap:"24px"}},{default:o(()=>[t(C,{flex:"auto",style:{display:"inline-flex","justify-content":"center"}},{default:o(()=>[t(v,{variant:"text",shape:"square",onClick:I=>q(a.id)},{default:o(()=>[t(c(pe))]),_:1},8,["onClick"])]),_:2},1024),t(C,{flex:"auto",style:{display:"inline-flex","justify-content":"center"}},{default:o(()=>[t(v,{variant:"text",shape:"square",onClick:I=>O("https://k5ws.vicicode.cn"+a.image)},{default:o(()=>[t(c(ce))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1}),t(H,{onChange:F,style:{margin:"10px"},total:s.total,current:s.page,pageSize:24,showPageNumber:"",showPageSize:!1},null,8,["total","current"])]),_:1})]),_:1})]),_:1}),t($,{visible:s.showPanel,"onUpdate:visible":e[4]||(e[4]=a=>s.showPanel=a),size:"50%",header:"\u6211\u7684\u56FE\u7247",footer:!1,onDragenter:z,onDragleave:P,onDragover:S,onDrop:R},{default:o(()=>[p("div",Se,[t(v,{style:{margin:"10px"},onClick:j},{default:o(()=>[...e[9]||(e[9]=[l("\u4E0A\u4F20\u65B0\u56FE\u7247",-1)])]),_:1}),t(v,{loading:s.refLoading,shape:"circle",theme:"outline",onClick:M},{icon:o(()=>[t(c(me))]),_:1},8,["loading"])]),t(X,{split:!0},{default:o(()=>[(d(!0),k(b,null,L(s.myList,a=>(d(),y(W,null,{default:o(()=>[p("div",Re,[p("div",je,[a.status==0?(d(),y(h,{key:0,theme:"primary",variant:"outline"},{default:o(()=>[l("\u5BA1\u6838\u4E2D"+r(a.remark&&`\uFF08${a.remark}\uFF09`),1)]),_:2},1024)):a.status==1?(d(),y(h,{key:1,theme:"primary",variant:"outline"},{default:o(()=>[l("\u5DF2\u5BA1\u6838"+r(a.remark&&`\uFF08${a.remark}\uFF09`),1)]),_:2},1024)):(d(),y(h,{key:2,theme:"primary",variant:"outline"},{default:o(()=>[l("\u5DF2\u9A73\u56DE"+r(a.remark&&`\uFF08${a.remark}\uFF09`),1)]),_:2},1024)),l(" "+r(a.title)+" ",1),e[10]||(e[10]=p("br",null,null,-1)),l(" "+r(a.desc),1)]),p("div",Te,[t(h,null,{default:o(()=>[l(r(a.create_time_text),1)]),_:2},1024),e[12]||(e[12]=l("\xA0 ",-1)),t(K,{theme:"primary",hover:"color",onClick:I=>N(a.id)},{default:o(()=>[...e[11]||(e[11]=[l("\u5220\u9664",-1)])]),_:1},8,["onClick"])])])]),_:2},1024))),256))]),_:1})]),_:1},8,["visible"]),t($,{visible:s.showUpload,"onUpdate:visible":e[8]||(e[8]=a=>s.showUpload=a),size:"25%",header:"\u4E0A\u4F20\u65B0\u56FE\u7247",footer:!1},{default:o(()=>[t(ee,{data:i,"reset-type":"initial",colon:"",onSubmit:T},{default:o(()=>[t(x,{label:"\u56FE\u7247\u540D\u79F0",name:"title","label-align":"top"},{default:o(()=>[t(w,{modelValue:i.title,"onUpdate:modelValue":e[5]||(e[5]=a=>i.title=a)},null,8,["modelValue"])]),_:1}),t(x,{label:"\u56FE\u7247\u63CF\u8FF0",name:"desc","label-align":"top"},{default:o(()=>[t(Y,{autosize:{minRows:5,maxRows:10},modelValue:i.desc,"onUpdate:modelValue":e[6]||(e[6]=a=>i.desc=a),clearable:""},null,8,["modelValue"])]),_:1}),t(x,{label:"\u56FE\u7247\u6587\u4EF6",name:"firmware","label-align":"top"},{default:o(()=>[t(Z,{modelValue:i.firmware,"onUpdate:modelValue":e[7]||(e[7]=a=>i.firmware=a),action:"https://k5ws.vicicode.cn/api/ajax/upload?server=1","abridge-name":[8,6],headers:{"ba-user-token":c(u).accountId},theme:"file-input",placeholder:"\u672A\u9009\u62E9\u6587\u4EF6"},null,8,["modelValue","headers"])]),_:1}),t(x,{"label-align":"top"},{default:o(()=>[t(v,{theme:"primary",type:"submit",block:""},{default:o(()=>[...e[13]||(e[13]=[l("\u63D0\u4EA4\u5BA1\u6838",-1)])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])])}}});const kt=ne(qe,[["__scopeId","data-v-bc51700c"]]);export{kt as default};
