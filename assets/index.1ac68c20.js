import{d as K,g as x,_ as E}from"./index.c8f72eaa.js";import{P as H,Y as N,d as V,k as L,U as M,_ as O}from"./@arco-design.95e0b031.js";import"./vue.24dcbee8.js";import{u as j}from"./loading.0f5749b3.js";import{e as S,a as G,u as W,f as b,s as C,b as Y,g as q}from"./serial.d615852e.js";import{I as v,B as F,T as J}from"./tdesign-vue-next.62a9d0ce.js";import{G as Q}from"./tdesign-icons-vue-next.514651cc.js";import{d as X,h as P,c as Z,o as tt,a as et,x as s,u as i,e as z,A as u,z as h,_ as A}from"./@vue.2faf1d8e.js";import{v as at}from"./vue-i18n.4b9acc8b.js";import"./vue-echarts.29561399.js";import"./resize-detector.a8854a64.js";import"./echarts.5b0e6023.js";import"./zrender.ce26131e.js";import"./tslib.c6ba9914.js";import"./vue-router.425aabc5.js";import"./nprogress.77f16b3e.js";import"./@intlify.b8ed1d74.js";import"./mitt.550594b0.js";import"./pinia.510425a1.js";import"./vue-demi.1e0b7689.js";import"./axios.234ce069.js";import"./@vueuse.c5c16882.js";import"./aegis-web-sdk.088ecaea.js";import"./@zxing.8654f0db.js";import"./vue-matomo.ed94ba67.js";import"./b-tween.8dd4e2fe.js";import"./dayjs.08dc07e5.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";import"./sortablejs.b2e3c7c4.js";import"./@popperjs.f3f73334.js";const ot={class:"container"},nt={name:"dtmfContact"},rt=X({...nt,setup(it){const{t:f}=at.exports.useI18n(),r=K(),{loading:I,setLoading:_}=j(!1),o=P({renderData:Array.from({length:16}).map(t=>({})),pageSize:16,nowPage:1}),R=P({showHide:0}),$=t=>{o.renderData=t.newData},k=Z(()=>[{colKey:"drag",title:f("cps.sort"),width:46},{title:"#",colKey:"index",align:"left",width:100},{title:f("cps.contact"),colKey:"name",width:250,align:"left",cell:(t,{row:e})=>e.name,edit:{component:v,props:{clearable:!0},onEdited:t=>{const e=[...o.renderData];e.splice((o.nowPage-1)*o.pageSize+t.rowIndex,1,t.newRowData),o.renderData=e}}},{title:f("cps.dtmfid"),colKey:"dtmfid",align:"left",width:200,cell:(t,{row:e})=>e.dtmfid,edit:{component:v,props:{clearable:!0},onEdited:t=>{t.newRowData.dtmfid=t.newRowData.dtmfid?t.newRowData.dtmfid.toUpperCase():void 0;const e=[...o.renderData];e.splice((o.nowPage-1)*o.pageSize+t.rowIndex,1,t.newRowData),o.renderData=e}}},{title:f("cps.operate"),colKey:"operate",align:"left",width:150}]),T=async()=>{var l,c,n;if(r.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}await S(r.connectPort),_(!0);let t=new Uint8Array(256);for(let a=7168;a<7424;a+=16){const p=await G(r.connectPort,a,16,(l=r.configuration)==null?void 0:l.uart);t.set(p,a-7168)}const e=[];for(let a=0;a<256;a+=16)W(t.subarray(a,a+1))!="ff"?e.push({dtmfid:b(t.subarray(a+8,a+16),(c=r.configuration)==null?void 0:c.charset),name:b(t.subarray(a,a+8),(n=r.configuration)==null?void 0:n.charset)}):e.push({});o.renderData=e,_(!1)},U=async()=>{var e,l,c;if(r.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}await S(r.connectPort),_(!0);let t=[];for(let n=0;n<16;n++){let a=o.renderData[n].dtmfid,p=o.renderData[n].name;if(a&&p){a=a.trim(),p=p.trim();let m=new Uint8Array(16),g=new Uint8Array(8),w=new Uint8Array(8),y=C(a,(e=r.configuration)==null?void 0:e.charset).slice(0,8);g.set(y);let d=C(p,(l=r.configuration)==null?void 0:l.charset).slice(0,8);w.set(d),m.set(w),m.set(g,8),t.push(m)}}if(t.length<16)for(let n=t.length;n<16;n++){let a=new Uint8Array(16);a[0]=255,a[8]=255,t[n]=a}for(let n=0;n<t.length;n++)await Y(r.connectPort,n*16+7168,t[n],16,(c=r.configuration)==null?void 0:c.uart);await q(r.connectPort),_(!1)},B=async t=>{const e=[...o.renderData];e.splice(t,1,{scanlist:[]}),o.renderData=e};return(t,e)=>{const l=x,c=N,n=V,a=L,p=M,m=O,g=F,w=J,y=H;return tt(),et("div",ot,[s(l,{items:[t.$t("menu.dashboard"),t.$t("menu.cps.dtmf")]},null,8,["items"]),s(y,{class:"general-card"},{title:i(()=>[z("span",{onClick:e[0]||(e[0]=()=>{R.showHide+=1})},u(t.$t("menu.cps.dtmf")+t.$t("global.onStart")),1)]),default:i(()=>[s(m,{style:{"margin-bottom":"16px"}},{default:i(()=>[s(p,{span:12},{default:i(()=>[s(a,null,{default:i(()=>[s(n,{type:"primary",onClick:T},{icon:i(()=>[s(c)]),default:i(()=>[h(" "+u(t.$t("cps.onDeviceRead")),1)]),_:1}),s(n,{onClick:U},{icon:i(()=>[s(c)]),default:i(()=>[h(" "+u(t.$t("cps.onDeviceWrite")),1)]),_:1})]),_:1})]),_:1})]),_:1}),s(w,{class:"ttable",loading:A(I),size:"medium",columns:k.value,data:o.renderData,pagination:{defaultPageSize:o.pageSize,total:o.renderData.length,defaultCurrent:1,pageSizeOptions:[15,30,50,100,200]},onChange:e[1]||(e[1]=d=>{o.pageSize=d.pagination.pageSize,o.nowPage=d.pagination.current}),bordered:"","lazy-load":"",headerAffixedTop:{offsetTop:60},hover:!0,"drag-sort":"row-handler",onDragSort:$},{drag:i(({row:d,rowIndex:D})=>[z("span",null,[s(A(Q))])]),index:i(({row:d,rowIndex:D})=>[h(u((o.nowPage-1)*o.pageSize+D+1),1)]),operate:i(({row:d,rowIndex:D})=>[s(g,{theme:"default",variant:"dashed",onClick:st=>B((o.nowPage-1)*o.pageSize+D)},{default:i(()=>[h(u(t.$t("cps.clear")),1)]),_:2},1032,["onClick"])]),_:1},8,["loading","columns","data","pagination"])]),_:1})])}}});const Mt=E(rt,[["__scopeId","data-v-72c5810e"]]);export{Mt as default};
