import{d as Y,u as Z,g as tt,_ as et}from"./index.0e1dd8c9.js";import{a4 as ot,a5 as at,U as nt,M as E,a6 as st,a7 as lt,W as it,a0 as rt}from"./@arco-design.282d06c8.js";import"./vue.ffb667bf.js";import{b as ut}from"./vue-router.a9f5d186.js";import{a as k}from"./axios.06033baf.js";import{J as dt,K as pt}from"./tdesign-icons-vue-next.f086fa1d.js";import{I as mt,i as ct,P as _t,B as ft,L as wt,j as gt,k as kt,l as Ft,F as yt,m as ht,U as vt,a as bt}from"./tdesign-vue-next.d1c1adb1.js";import{d as xt,h as U,l as At,o as d,a as F,x as a,u as o,b as m,z as l,A as i,_ as c,F as b,Q as L,s as y}from"./@vue.6ceb3fa6.js";import"./nprogress.6328d444.js";import"./@intlify.02b6985d.js";import"./mitt.550594b0.js";import"./pinia.fa8b6be2.js";import"./vue-demi.0e7683c7.js";import"./vue-i18n.5fb6db72.js";import"./@vueuse.a7db99fe.js";import"./aegis-web-sdk.d24318d3.js";import"./@zxing.8654f0db.js";import"./vue-matomo.5bdfe9a5.js";import"./b-tween.8dd4e2fe.js";import"./dayjs.35d19ede.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";import"./lodash-es.18922ecc.js";import"./sortablejs.77296005.js";import"./@popperjs.f3f73334.js";import"./@babel.9b6013fe.js";const Ct={class:"container"},$t={style:{display:"flex",gap:"1rem","align-items":"flex-end"}},Et={style:{"margin-right":"20px"}},Ut={style:{color:"#373737",margin:"10px"}},Lt={style:{display:"flex","align-items":"center","justify-content":"space-between"}},It={style:{display:"flex",width:"100%"}},Bt={style:{width:"90%"}},Dt={style:{width:"40%",margin:"auto","text-align":"center"}},Vt={name:"Backup"},Pt=xt({...Vt,setup(St){Y();const p=Z(),I=ut(),s=U({binaryFile:void 0,loading:!1,showPanel:!1,showUpload:!1,refLoading:!1,myList:[],total:0,page:1,nowpage:[],title:""}),r=U({title:"",desc:"",firmware:[]});At(async()=>{x({current:1})});const x=async n=>{s.page=n.current;const t=await k.get("https://k5ws.vicicode.cn/api/firmware/index?server=1&limit=12&page="+n.current+"&title="+s.title+"&t="+Date.now());s.total=t.data.total,s.nowpage=t.data.list},w=async()=>{s.refLoading=!0,s.showPanel=!0;const n=await k.post("https://k5ws.vicicode.cn/api/firmware/my?server=1",{},{headers:{"ba-user-token":p.accountId}});s.myList=n.data,s.refLoading=!1},B=()=>{r.title="",r.desc="",r.firmware=[],s.showUpload=!0},D=async()=>{if(r.title==""||r.firmware.code==0){E.error({content:"\u672A\u586B\u5199\u540D\u79F0\u53CA\u4E0A\u4F20\u6587\u4EF6",duration:5*1e3});return}await k.post("https://k5ws.vicicode.cn/api/firmware/add?server=1",{title:r.title,desc:r.desc,data:r.firmware[0].response.data.file.url},{headers:{"ba-user-token":p.accountId}}),s.showUpload=!1,w()},V=async n=>{await k.post("https://k5ws.vicicode.cn/api/firmware/del?server=1",{id:n},{headers:{"ba-user-token":p.accountId}}),w()},P=async n=>{s.nowpage.filter(t=>{t.id==n&&(t.star+=1)}),await k.post("https://k5ws.vicicode.cn/api/firmware/star?server=1",{id:n}),E.success({content:"\u70B9\u8D5E\u6210\u529F",duration:5*1e3})},S=()=>{w()},R=n=>{I.push({path:"/tool/flash",query:{url:n}})},z=(n,t)=>{t.split(".").reverse()[0]!=="bin"&&(t+=".bin"),fetch(n).then(g=>g.blob()).then(g=>{const h=URL.createObjectURL(g),u=document.createElement("a");u.href=h,u.download=t,document.body.appendChild(u),u.click(),document.body.removeChild(u)})},C=()=>{x({current:1})};return(n,t)=>{const g=tt,h=mt,u=ot,_=ct,j=st,M=lt,N=at,T=_t,q=nt,J=it,K=rt,A=ft,O=wt,Q=gt,W=kt,$=Ft,v=yt,G=ht,H=vt,X=bt;return d(),F("div",Ct,[a(g,{items:[n.$t("menu.workshop"),n.$t("menu.firmware")]},null,8,["items"]),a(K,{gutter:20,align:"stretch"},{default:o(()=>[a(J,{span:24},{default:o(()=>[a(q,{class:"general-card"},{title:o(()=>[m("div",$t,[l(i(n.$t("menu.firmware"))+" ",1),a(h,{size:"small",style:{width:"200px"},modelValue:s.title,"onUpdate:modelValue":t[0]||(t[0]=e=>s.title=e),onEnter:C},{suffixIcon:o(()=>[a(c(dt),{style:{cursor:"pointer"},onClick:C})]),_:1},8,["modelValue"])])]),extra:o(()=>[m("div",Et,[c(p).name?(d(),F(b,{key:0},[a(u,{onClick:w},{default:o(()=>[l("\xA0\xA0"+i(c(p).name)+"\xA0\xA0",1)]),_:1}),a(u,{onClick:w},{default:o(()=>[l("\xA0\xA0"+i(n.$t("global.upload"))+"\xA0\xA0",1)]),_:1}),a(u,{onClick:t[1]||(t[1]=e=>c(p).logout())},{default:o(()=>[l("\xA0\xA0"+i(n.$t("global.logout"))+"\xA0\xA0",1)]),_:1})],64)):(d(),F(b,{key:1},[a(u,{onClick:t[2]||(t[2]=e=>c(p).setInfo({showLogin:!0}))},{default:o(()=>[l("\xA0\xA0"+i(n.$t("global.login"))+"\xA0\xA0",1)]),_:1}),a(u,{onClick:t[3]||(t[3]=e=>c(p).setInfo({showRegister:!0}))},{default:o(()=>[l("\xA0\xA0"+i(n.$t("global.register"))+"\xA0\xA0",1)]),_:1}),m("span",Ut,i(n.$t("global.loginUpload")),1)],64))])]),default:o(()=>[a(N,null,{default:o(()=>[(d(!0),F(b,null,L(s.nowpage,e=>(d(),y(M,{style:{width:"100%"}},{actions:o(()=>[a(_,{style:{"margin-left":"1rem"}},{default:o(()=>[l(i(e.create_time_text),1)]),_:2},1024),a(u,{style:{"min-width":"100px"},onClick:f=>P(e.id)},{default:o(()=>[l("\u{1F44D}\uFF08"+i(e.star)+"\uFF09",1)]),_:2},1032,["onClick"]),a(u,{style:{"min-width":"70px"},onClick:f=>z("https://k5ws.vicicode.cn"+e.file,e.title)},{default:o(()=>[l(i(n.$t("global.download")),1)]),_:1},8,["onClick"]),a(u,{style:{"min-width":"70px"},onClick:f=>R("https://k5ws.vicicode.cn"+e.file+"?n=/"+e.title)},{default:o(()=>[l(i(n.$t("global.use")),1)]),_:1},8,["onClick"])]),default:o(()=>[a(j,{description:e.desc},{title:o(()=>[a(_,{theme:"primary",variant:"outline"},{default:o(()=>{var f;return[l(i((f=e.user)==null?void 0:f.nickname),1)]}),_:2},1024),l(" "+i(e.title),1)]),_:2},1032,["description"])]),_:2},1024))),256))]),_:1}),a(T,{onChange:x,style:{margin:"10px"},total:s.total,current:s.page,pageSize:12,showPageNumber:"",showPageSize:!1},null,8,["total","current"])]),_:1})]),_:1})]),_:1}),a($,{visible:s.showPanel,"onUpdate:visible":t[4]||(t[4]=e=>s.showPanel=e),size:"50%",header:"\u6211\u7684\u56FA\u4EF6",footer:!1},{default:o(()=>[m("div",Lt,[a(A,{style:{margin:"10px"},onClick:B},{default:o(()=>[...t[9]||(t[9]=[l("\u4E0A\u4F20\u65B0\u56FA\u4EF6",-1)])]),_:1}),a(A,{loading:s.refLoading,shape:"circle",theme:"outline",onClick:S},{icon:o(()=>[a(c(pt))]),_:1},8,["loading"])]),a(W,{split:!0},{default:o(()=>[(d(!0),F(b,null,L(s.myList,e=>(d(),y(Q,null,{default:o(()=>[m("div",It,[m("div",Bt,[e.status==0?(d(),y(_,{key:0,theme:"primary",variant:"outline"},{default:o(()=>[l("\u5BA1\u6838\u4E2D"+i(e.remark&&`\uFF08${e.remark}\uFF09`),1)]),_:2},1024)):e.status==1?(d(),y(_,{key:1,theme:"primary",variant:"outline"},{default:o(()=>[l("\u5DF2\u5BA1\u6838"+i(e.remark&&`\uFF08${e.remark}\uFF09`),1)]),_:2},1024)):(d(),y(_,{key:2,theme:"primary",variant:"outline"},{default:o(()=>[l("\u5DF2\u9A73\u56DE"+i(e.remark&&`\uFF08${e.remark}\uFF09`),1)]),_:2},1024)),l(" "+i(e.title)+" ",1),t[10]||(t[10]=m("br",null,null,-1)),l(" "+i(e.desc),1)]),m("div",Dt,[a(_,null,{default:o(()=>[l(i(e.create_time_text),1)]),_:2},1024),t[12]||(t[12]=l("\xA0 ",-1)),a(O,{theme:"primary",hover:"color",onClick:f=>V(e.id)},{default:o(()=>[...t[11]||(t[11]=[l("\u5220\u9664",-1)])]),_:1},8,["onClick"])])])]),_:2},1024))),256))]),_:1})]),_:1},8,["visible"]),a($,{visible:s.showUpload,"onUpdate:visible":t[8]||(t[8]=e=>s.showUpload=e),size:"25%",header:"\u4E0A\u4F20\u65B0\u56FA\u4EF6",footer:!1},{default:o(()=>[a(X,{data:r,"reset-type":"initial",colon:"",onSubmit:D},{default:o(()=>[a(v,{label:"\u56FA\u4EF6\u540D\u79F0",name:"title","label-align":"top"},{default:o(()=>[a(h,{modelValue:r.title,"onUpdate:modelValue":t[5]||(t[5]=e=>r.title=e)},null,8,["modelValue"])]),_:1}),a(v,{label:"\u56FA\u4EF6\u63CF\u8FF0",name:"desc","label-align":"top"},{default:o(()=>[a(G,{maxlength:200,autosize:{minRows:5,maxRows:10},modelValue:r.desc,"onUpdate:modelValue":t[6]||(t[6]=e=>r.desc=e),clearable:""},null,8,["modelValue"])]),_:1}),a(v,{label:"\u56FA\u4EF6\u6587\u4EF6",name:"firmware","label-align":"top"},{default:o(()=>[a(H,{modelValue:r.firmware,"onUpdate:modelValue":t[7]||(t[7]=e=>r.firmware=e),action:"https://k5ws.vicicode.cn/api/ajax/upload?server=1","abridge-name":[8,6],headers:{"ba-user-token":c(p).accountId},theme:"file-input",placeholder:"\u672A\u9009\u62E9\u6587\u4EF6"},null,8,["modelValue","headers"])]),_:1}),a(v,{"label-align":"top"},{default:o(()=>[a(A,{theme:"primary",type:"submit",block:""},{default:o(()=>[...t[13]||(t[13]=[l("\u63D0\u4EA4\u5BA1\u6838",-1)])]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])])}}});const me=et(Pt,[["__scopeId","data-v-e97fa37a"]]);export{me as default};
