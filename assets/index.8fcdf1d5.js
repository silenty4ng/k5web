import{d as L,g as N,_ as A}from"./index.09b560e5.js";import{P as j,a0 as O,d as T,k as z,U as q,_ as H}from"./@arco-design.10d71e42.js";import"./vue.ffb667bf.js";import{u as K}from"./vue-router.a9f5d186.js";import{e as C,g as E,i as $,d as Q}from"./serial.c4ab9612.js";import{p as G}from"./tdesign-vue-next.ed813ef2.js";import{d as J,h as W,l as X,o as b,a as x,x as g,u as h,b as y,F as k,Q as F,e as Y,z as v,A as S}from"./@vue.6ceb3fa6.js";import"./nprogress.6328d444.js";import"./@intlify.02b6985d.js";import"./mitt.550594b0.js";import"./pinia.fa8b6be2.js";import"./vue-demi.0e7683c7.js";import"./axios.06033baf.js";import"./vue-i18n.5fb6db72.js";import"./@vueuse.a7db99fe.js";import"./@zxing.8654f0db.js";import"./@microsoft.d2aaf3b7.js";import"./vue-matomo.5bdfe9a5.js";import"./b-tween.8dd4e2fe.js";import"./dayjs.35d19ede.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";import"./lodash-es.18922ecc.js";import"./sortablejs.77296005.js";import"./@popperjs.f3f73334.js";import"./@babel.9b6013fe.js";const Z={class:"container"},tt={style:{padding:"0",margin:"0","border-spacing":"0"}},et=["onMousedown","onMouseover"],ot={name:"Image"},nt=J({...ot,setup(at){const u=L(),o=W({binaryFile:void 0,loading:!1,matrix:[],mousedown:!1,threshold:128,cache:void 0}),I=K();X(async()=>{if(I.query.url){const n=await fetch(I.query.url,{responseType:"blob"});D(window.URL.createObjectURL(await n.blob()))}});const R=()=>{const n=o.matrix;n.map((t,e)=>{t.map((a,i)=>{n[e][i]=a=="#fff"?"#000":"#fff"})}),o.matrix=n},P=(n,t)=>{if(o.mousedown){const e=o.matrix;e[t][n]=o.matrix[t][n]=="#fff"?"#000":"#fff",o.matrix=e}},D=n=>{const t=document.createElement("canvas");t.width=128,t.height=64;const e=t.cloneNode(),a=document.getElementById("canvasDiv");a.innerHTML="",a==null||a.append(t,e);const i=new Image;i.src=n,i.onload=()=>{const s=t.getContext("2d");s==null||s.drawImage(i,0,0,128,64);const d=s==null?void 0:s.getImageData(0,0,t.width,t.height).data;o.cache=d;function _(l,c){const m=(c*128+l)*4;return d[m]+d[m+1]+d[m+2]>o.threshold*3?0:1}const p=[];for(let l=0;l<64;l++){p.push([]),p[l]=[];for(let c=0;c<128;c++){const r=!_(c,l);p[l][c]=r?"#fff":"#000"}}o.matrix=p}},M=()=>{const n=document.createElement("input");n.type="file",n.onchange=async()=>{const t=new Blob([n.files[0]],{type:"application/octet-stream"}),e=URL.createObjectURL(t),a=document.createElement("canvas");a.width=128,a.height=64;const i=new Image;i.src=e,i.onload=()=>{const s=a.getContext("2d");s==null||s.drawImage(i,0,0,128,64);const d=s==null?void 0:s.getImageData(0,0,a.width,a.height).data;o.cache=d;function _(l,c){const m=(c*128+l)*4;return d[m]+d[m+1]+d[m+2]>o.threshold*3?0:1}const p=[];for(let l=0;l<64;l++){p.push([]),p[l]=[];for(let c=0;c<128;c++){const r=!_(c,l);p[l][c]=r?"#fff":"#000"}}o.matrix=p}},n.click()},V=async()=>{const n=o.matrix,t=document.createElement("canvas");t.width=128,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#fff",e.fillRect(0,0,t.width,t.height),e.fillStyle="#000");for(let i=0;i<64;i++)for(let s=0;s<128;s++)n[i][s]=="#000"&&(e==null||e.beginPath(),e==null||e.rect(s,i,1,1),e==null||e.fill());const a=document.createElement("a");a.href=t.toDataURL("image/jpeg",1),a.download="image.jpg",a.click()},U=async()=>{var i,s,d,_,p,l,c;const n=new Uint8Array(1024);let t=0;for(let r=0;r<64;r+=8)for(let m=0;m<128;m++){let f=0;for(let w=0;w<8;w++)f|=(o.matrix[r+w][m]=="#000"?1:0)<<w;n[t++]=f}if(o.binaryFile=n,u.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}if(((i=u.configuration)==null?void 0:i.uart)=="official"){if(((s=u.configuration)==null?void 0:s.charset)!="gb2312"){alert(sessionStorage.getItem("noticeVersionNoSupport"));return}o.loading=!0;let r=12288;await C(u.connectPort);let m=o.binaryFile;m=[90,90,188,154,0,4,255,255,...m];for(let f=r;f<m.length+r;f+=64)await E(u.connectPort,f,m.slice(f-r,f-r+64),m.slice(f-r,f-r+64).length,(d=u.configuration)==null?void 0:d.uart);await $(u.connectPort),o.loading=!1,await Q(u.connectPort),u.updateSettings({connectState:!1,connectPort:null,firmwareVersion:""});return}if(((_=u.configuration)==null?void 0:_.charset)!="losehu"&&((p=u.configuration)==null?void 0:p.charset)!="gb2312"){alert(sessionStorage.getItem("noticeVersionNoSupport"));return}o.loading=!0;let e=123728;((l=u.configuration)==null?void 0:l.charset)=="gb2312"&&(e=8320),await C(u.connectPort);const a=o.binaryFile;for(let r=e;r<a.length+e;r+=64)await E(u.connectPort,r,a.slice(r-e,r-e+64),a.slice(r-e,r-e+64).length,(c=u.configuration)==null?void 0:c.uart);await $(u.connectPort),o.loading=!1},B=()=>{const n=o.cache;function t(a,i){const d=(i*128+a)*4;return n[d]+n[d+1]+n[d+2]>o.threshold*3?0:1}const e=[];for(let a=0;a<64;a++){e.push([]),e[a]=[];for(let i=0;i<128;i++){const s=!t(i,a);e[a][i]=s?"#fff":"#000"}}o.matrix=e};return(n,t)=>{const e=N,a=G,i=T,s=z,d=j,_=O,p=q,l=H;return b(),x("div",Z,[g(e,{items:[n.$t("menu.list"),n.$t("menu.image")]},null,8,["items"]),g(l,{gutter:20,align:"stretch"},{default:h(()=>[g(p,{span:24},{default:h(()=>[g(_,{loading:o.loading,tip:"\u5199\u5165\u4E2D...",style:{width:"100%"}},{default:h(()=>[g(d,{class:"general-card",title:n.$t("menu.image")+n.$t("global.onStart")},{default:h(()=>[t[2]||(t[2]=y("div",{id:"canvasDiv",style:{zoom:"250%",display:"none"}},null,-1)),y("div",null,[y("table",tt,[(b(!0),x(k,null,F(o.matrix,(c,r)=>(b(),x("tr",null,[(b(!0),x(k,null,F(c,(m,f)=>(b(),x("td",{onMousedown:w=>{o.mousedown=!0,P(f,r)},onMouseup:t[0]||(t[0]=w=>{o.mousedown=!1}),onMouseover:w=>P(f,r),style:Y("background-color: "+m+"; height: 5px; width: 3.5px;")},null,44,et))),256))]))),256))])]),t[3]||(t[3]=y("br",null,null,-1)),t[4]||(t[4]=v(" \u8272\u5F69\u9608\u503C\uFF1A",-1)),g(a,{modelValue:o.threshold,"onUpdate:modelValue":t[1]||(t[1]=c=>o.threshold=c),max:256,style:{width:"200px"},onChangeEnd:B},null,8,["modelValue"]),t[5]||(t[5]=y("br",null,null,-1)),g(s,null,{default:h(()=>[g(i,{onClick:M},{default:h(()=>[v(S(n.$t("tool.selectImage")),1)]),_:1}),g(i,{disabled:o.matrix.length<64,onClick:R},{default:h(()=>[v(S(n.$t("image.negative")),1)]),_:1},8,["disabled"]),g(i,{disabled:o.matrix.length<64,onClick:V},{default:h(()=>[v(S(n.$t("cps.save")),1)]),_:1},8,["disabled"]),g(i,{type:"primary",disabled:o.matrix.length<64,onClick:U},{default:h(()=>[v(S(n.$t("tool.write")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["title"])]),_:1},8,["loading"])]),_:1})]),_:1})])}}});const Vt=A(nt,[["__scopeId","data-v-cf515bae"]]);export{Vt as default};
