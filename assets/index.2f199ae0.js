import{d as B,g as L,_ as N}from"./index.0a582faf.js";import{P as A,a0 as j,d as T,k as z,U as O,_ as q}from"./@arco-design.95e0b031.js";import"./vue.24dcbee8.js";import{u as H}from"./vue-router.425aabc5.js";import{e as K,b as Q,g as G}from"./serial.d615852e.js";import{p as J}from"./tdesign-vue-next.62a9d0ce.js";import{d as W,h as X,l as Y,o as _,a as b,x as p,u as g,e as x,F as k,Q as P,b as Z,z as w,A as v,b9 as tt,b8 as et}from"./@vue.2faf1d8e.js";import"./vue-echarts.29561399.js";import"./resize-detector.a8854a64.js";import"./echarts.5b0e6023.js";import"./zrender.ce26131e.js";import"./tslib.c6ba9914.js";import"./nprogress.77f16b3e.js";import"./@intlify.b8ed1d74.js";import"./mitt.550594b0.js";import"./pinia.510425a1.js";import"./vue-demi.1e0b7689.js";import"./axios.234ce069.js";import"./vue-i18n.4b9acc8b.js";import"./@vueuse.c5c16882.js";import"./aegis-web-sdk.088ecaea.js";import"./@zxing.8654f0db.js";import"./vue-matomo.ed94ba67.js";import"./b-tween.8dd4e2fe.js";import"./dayjs.08dc07e5.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";import"./tdesign-icons-vue-next.514651cc.js";import"./sortablejs.b2e3c7c4.js";import"./@popperjs.f3f73334.js";const I=y=>(tt("data-v-132b4f44"),y=y(),et(),y),ot={class:"container"},nt=I(()=>x("div",{id:"canvasDiv",style:{zoom:"250%",display:"none"}},null,-1)),at={style:{padding:"0",margin:"0","border-spacing":"0"}},it=["onMousedown","onMouseover"],st=I(()=>x("br",null,null,-1)),rt=I(()=>x("br",null,null,-1)),lt={name:"Image"},ct=W({...lt,setup(y){const f=B(),o=X({binaryFile:void 0,loading:!1,matrix:[],mousedown:!1,threshold:128,cache:void 0}),S=H();Y(async()=>{if(S.query.url){const e=await fetch(S.query.url,{responseType:"blob"});F(window.URL.createObjectURL(await e.blob()))}});const D=()=>{const e=o.matrix;e.map((n,t)=>{n.map((a,i)=>{e[t][i]=a=="#fff"?"#000":"#fff"})}),o.matrix=e},C=(e,n)=>{if(o.mousedown){const t=o.matrix;t[n][e]=o.matrix[n][e]=="#fff"?"#000":"#fff",o.matrix=t}},F=e=>{const n=document.createElement("canvas");n.width=128,n.height=64;const t=n.cloneNode(),a=document.getElementById("canvasDiv");a.innerHTML="",a==null||a.append(n,t);const i=new Image;i.src=e,i.onload=()=>{const r=n.getContext("2d");r==null||r.drawImage(i,0,0,128,64);const c=r==null?void 0:r.getImageData(0,0,n.width,n.height).data;o.cache=c;function h(s,l){const d=(l*128+s)*4;return c[d]+c[d+1]+c[d+2]>o.threshold*3?0:1}const m=[];for(let s=0;s<64;s++){m.push([]),m[s]=[];for(let l=0;l<128;l++){const u=!h(l,s);m[s][l]=u?"#fff":"#000"}}o.matrix=m}},R=()=>{const e=document.createElement("input");e.type="file",e.onchange=async()=>{const n=new Blob([e.files[0]],{type:"application/octet-stream"}),t=URL.createObjectURL(n),a=document.createElement("canvas");a.width=128,a.height=64;const i=new Image;i.src=t,i.onload=()=>{const r=a.getContext("2d");r==null||r.drawImage(i,0,0,128,64);const c=r==null?void 0:r.getImageData(0,0,a.width,a.height).data;o.cache=c;function h(s,l){const d=(l*128+s)*4;return c[d]+c[d+1]+c[d+2]>o.threshold*3?0:1}const m=[];for(let s=0;s<64;s++){m.push([]),m[s]=[];for(let l=0;l<128;l++){const u=!h(l,s);m[s][l]=u?"#fff":"#000"}}o.matrix=m}},e.click()},M=async()=>{const e=o.matrix,n=document.createElement("canvas");n.width=128,n.height=64;const t=n.getContext("2d");t&&(t.fillStyle="#fff",t.fillRect(0,0,n.width,n.height),t.fillStyle="#000");for(let i=0;i<64;i++)for(let r=0;r<128;r++)e[i][r]=="#000"&&(t==null||t.beginPath(),t==null||t.rect(r,i,1,1),t==null||t.fill());const a=document.createElement("a");a.href=n.toDataURL("image/jpeg",1),a.download="image.jpg",a.click()},U=async()=>{var i,r,c,h,m;const e=new Uint8Array(1024);let n=0;for(let s=0;s<64;s+=8)for(let l=0;l<128;l++){let u=0;for(let d=0;d<8;d++)u|=(o.matrix[s+d][l]=="#000"?1:0)<<d;e[n++]=u}if(o.binaryFile=e,f.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}if(((i=f.configuration)==null?void 0:i.uart)=="official"){alert(sessionStorage.getItem("noticeVersionNoSupport"));return}if(((r=f.configuration)==null?void 0:r.charset)!="losehu"&&((c=f.configuration)==null?void 0:c.charset)!="gb2312"){alert(sessionStorage.getItem("noticeVersionNoSupport"));return}o.loading=!0;let t=123728;((h=f.configuration)==null?void 0:h.charset)=="gb2312"&&(t=8320),await K(f.connectPort);const a=o.binaryFile;for(let s=t;s<a.length+t;s+=128)await Q(f.connectPort,s,a.slice(s-t,s-t+128),a.slice(s-t,s-t+128).length,(m=f.configuration)==null?void 0:m.uart);await G(f.connectPort),o.loading=!1},V=()=>{const e=o.cache;function n(a,i){const c=(i*128+a)*4;return e[c]+e[c+1]+e[c+2]>o.threshold*3?0:1}const t=[];for(let a=0;a<64;a++){t.push([]),t[a]=[];for(let i=0;i<128;i++){const r=!n(i,a);t[a][i]=r?"#fff":"#000"}}o.matrix=t};return(e,n)=>{const t=L,a=J,i=T,r=z,c=A,h=j,m=O,s=q;return _(),b("div",ot,[p(t,{items:[e.$t("menu.list"),e.$t("menu.image")]},null,8,["items"]),p(s,{gutter:20,align:"stretch"},{default:g(()=>[p(m,{span:24},{default:g(()=>[p(h,{loading:o.loading,tip:"\u5199\u5165\u4E2D...",style:{width:"100%"}},{default:g(()=>[p(c,{class:"general-card",title:e.$t("menu.image")+e.$t("global.onStart")},{default:g(()=>[nt,x("div",null,[x("table",at,[(_(!0),b(k,null,P(o.matrix,(l,u)=>(_(),b("tr",null,[(_(!0),b(k,null,P(l,(d,E)=>(_(),b("td",{onMousedown:$=>{o.mousedown=!0,C(E,u)},onMouseup:n[0]||(n[0]=$=>{o.mousedown=!1}),onMouseover:$=>C(E,u),style:Z("background-color: "+d+"; height: 5px; width: 3.5px;")},null,44,it))),256))]))),256))])]),st,w(" \u8272\u5F69\u9608\u503C\uFF1A"),p(a,{modelValue:o.threshold,"onUpdate:modelValue":n[1]||(n[1]=l=>o.threshold=l),max:256,style:{width:"200px"},onChangeEnd:V},null,8,["modelValue"]),rt,p(r,null,{default:g(()=>[p(i,{onClick:R},{default:g(()=>[w(v(e.$t("tool.selectImage")),1)]),_:1}),p(i,{disabled:o.matrix.length<64,onClick:D},{default:g(()=>[w(v(e.$t("image.negative")),1)]),_:1},8,["disabled"]),p(i,{disabled:o.matrix.length<64,onClick:M},{default:g(()=>[w(v(e.$t("cps.save")),1)]),_:1},8,["disabled"]),p(i,{type:"primary",disabled:o.matrix.length<64,onClick:U},{default:g(()=>[w(v(e.$t("tool.write")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["title"])]),_:1},8,["loading"])]),_:1})]),_:1})])}}});const Ot=N(ct,[["__scopeId","data-v-132b4f44"]]);export{Ot as default};
