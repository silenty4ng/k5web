import{d as v,g as D,_ as k}from"./index.e43177a6.js";import{U as N,d as P,k as O,R as x,n as R,P as V,W as $,a0 as S}from"./@arco-design.282d06c8.js";import"./vue.ffb667bf.js";import{u as T}from"./vue-router.a9f5d186.js";import{d as F,c as I,r as f,j as y,k as j,l as q,m as H}from"./serial.0b46e76d.js";import{D as M}from"./tdesign-vue-next.d1c1adb1.js";import{d as U,h as L,l as z,o as K,a as W,x as n,u as i,b as c,z as _,A as E,D as b}from"./@vue.6ceb3fa6.js";import"./nprogress.6328d444.js";import"./@intlify.02b6985d.js";import"./mitt.550594b0.js";import"./pinia.fa8b6be2.js";import"./vue-demi.0e7683c7.js";import"./axios.06033baf.js";import"./vue-i18n.5fb6db72.js";import"./@vueuse.a7db99fe.js";import"./aegis-web-sdk.d24318d3.js";import"./@zxing.8654f0db.js";import"./vue-matomo.5bdfe9a5.js";import"./b-tween.8dd4e2fe.js";import"./dayjs.35d19ede.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";import"./lodash-es.18922ecc.js";import"./tdesign-icons-vue-next.f086fa1d.js";import"./sortablejs.77296005.js";import"./@popperjs.f3f73334.js";import"./@babel.9b6013fe.js";const G={class:"container"},J={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Q=["innerHTML"],X={name:"Flash"},Y=U({...X,setup(Z){const d=v(),e=L({status:"\u70B9\u51FB\u66F4\u65B0\u6309\u94AE\u66F4\u65B0\u56FA\u4EF6\u5230\u8BBE\u5907<br/><br/>",binaryFile:void 0,binaryName:"",protocol:"Official"}),l=T();z(async()=>{var a;if(l.query.url){const o=await fetch(l.query.url),r=(a=o==null?void 0:o.body)==null?void 0:a.getReader();if(r){const s=[];for(;;){const{done:m,value:p}=await r.read();if(m)break;s.push(...p)}const u=new Uint8Array(s);e.binaryFile=u,e.binaryName=l.query.url.substring(l.query.url.lastIndexOf("/")+1).split("?")[0]+" "}}const t=M.confirm({header:"\u26A0\uFE0F\u63D0\u793A",body:"\u6CC9\u76DB K5/K6 \u5F53\u524D\u5728\u552E\u4E24\u4E2A\u786C\u4EF6\u7248\u672C\uFF0C\u5982\u4F7F\u7528\u7B2C\u4E09\u65B9\u56FA\u4EF6\u8BF7\u5148\u4E0E\u5546\u5BB6\u786E\u8BA4\u53EF\u4EE5\u5347\u7EA7\u5230\u7B2C\u4E09\u65B9\u56FA\u4EF6\u3002",className:"t-dialog-new-class1 t-dialog-new-class2",style:"color: rgba(0, 0, 0, 0.6)",confirmBtn:"\u6211\u77E5\u9053\u4E86",cancelBtn:null,closeBtn:!1,onConfirm:()=>{t.destroy()}})});const B=()=>{const t=document.createElement("input");t.type="file",t.onchange=async()=>{const a=new Blob([t.files[0]],{type:"application/octet-stream"}),o=new Uint8Array(await a.arrayBuffer());e.binaryFile=o,e.binaryName=t.files[0].name},t.click()},g=async()=>{if(!e.binaryFile){alert("\u8BF7\u9009\u62E9\u6587\u4EF6");return}d.connectPort&&await F(d.connectPort);let t=await I();e.protocol=="Official"&&await f(t,24,1e3),e.protocol=="Official"&&(await y(t,[48,5,16,0,42,79,69,70,87,45,76,79,83,69,72,85,0,0,0,0]),await f(t,24));const a=j(e.binaryFile);if(a.length>61440)throw alert("\u6700\u540E\u7684\u8FB9\u754C\u68C0\u67E5\u5931\u8D25\u3002\u4E0D\u7BA1\u662F\u8C01\u4FEE\u6539\u4E86\u4EE3\u7801\uFF0C\u4ED6\u90FD\u662F\u4E2A\u767D\u75F4\u3002"),new Error("Last resort boundary check failed. Whoever touched the code is an idiot.");for(let o=0;o<a.length;o+=256){const r=a.slice(o,o+256),s=q(r,o,a.length);try{await y(t,s),e.protocol=="Official"?await f(t,26):await H(t)}catch(u){return console.log("Flash command rejected. Aborting."),Promise.reject(u)}e.status=e.status+`\u66F4\u65B0\u8FDB\u5EA6 ${(o/a.length*100).toFixed(1)}%<br/>`,b(()=>{const u=document==null?void 0:document.getElementById("statusArea");u&&(u.scrollTop=u==null?void 0:u.scrollHeight)})}e.status=e.status+"\u66F4\u65B0\u8FDB\u5EA6 100.0%<br/>",e.status=e.status+"\u56FA\u4EF6\u66F4\u65B0\u6210\u529F",b(()=>{const o=document==null?void 0:document.getElementById("statusArea");o&&(o.scrollTop=o==null?void 0:o.scrollHeight)}),F(t),d.updateSettings({connectState:!1})};return(t,a)=>{const o=D,r=P,s=O,u=x,m=R,p=V,h=N,w=$,A=S;return K(),W("div",G,[n(o,{items:[t.$t("menu.list"),t.$t("menu.flash")]},null,8,["items"]),n(A,{gutter:20,align:"stretch"},{default:i(()=>[n(w,{span:24},{default:i(()=>[n(h,{class:"general-card",title:t.$t("menu.flash")+t.$t("global.onBoot")},{default:i(()=>[c("div",J,[c("div",null,[n(s,null,{default:i(()=>[n(r,{onClick:B},{default:i(()=>[_(E(e.binaryFile?e.binaryName:t.$t("tool.selectFirmware")),1)]),_:1}),n(r,{type:"primary",disabled:!e.binaryFile,onClick:g},{default:i(()=>[_(E(t.$t("tool.flash")),1)]),_:1},8,["disabled"])]),_:1})]),c("div",null,[n(m,{type:"button",size:"mini",modelValue:e.protocol,"onUpdate:modelValue":a[0]||(a[0]=C=>e.protocol=C)},{default:i(()=>[n(u,{value:"Official"},{default:i(()=>[...a[1]||(a[1]=[_("Official",-1)])]),_:1})]),_:1},8,["modelValue"])])]),n(p),c("div",{id:"statusArea",style:{height:"20em","background-color":"var(--color-bg-3)",color:"var(--color-text-3)",overflow:"auto",padding:"20px"},innerHTML:e.status},null,8,Q)]),_:1},8,["title"])]),_:1})]),_:1})])}}});const Pt=k(Y,[["__scopeId","data-v-74d00c06"]]);export{Pt as default};
