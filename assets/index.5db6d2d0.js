import{d as ee,u as te,g as ae,_ as oe}from"./index.309873d4.js";import{a2 as ne,a3 as se,P as le,M as I,a4 as ie,a5 as re,U as ue,_ as de}from"./@arco-design.5e2b2073.js";import"./vue.83b9e9de.js";import{b as ce}from"./vue-router.2630bdf9.js";import{a as h}from"./axios.f3f20840.js";import{H as pe,J as me}from"./tdesign-icons-vue-next.6eb4e7b8.js";import{I as _e,i as fe,P as he,B as we,L as ge,j as ke,k as ye,l as ve,F as xe,m as be,U as Fe,a as Ae}from"./tdesign-vue-next.de6f3c5b.js";import{d as Ce,h as U,l as $e,o as c,a as k,x as a,u as t,e as m,z as i,A as r,_ as p,F,Q as B,s as y,b9 as Le,b8 as Ee}from"./@vue.2faf1d8e.js";import"./nprogress.b0a22fe3.js";import"./@intlify.d4358f23.js";import"./mitt.550594b0.js";import"./pinia.84b4adc6.js";import"./vue-demi.61f15e01.js";import"./vue-i18n.3095106f.js";import"./@vueuse.7fb11548.js";import"./aegis-web-sdk.846094f8.js";import"./@zxing.8654f0db.js";import"./vue-matomo.4c7efa96.js";import"./b-tween.8dd4e2fe.js";import"./dayjs.4c867136.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";import"./sortablejs.b2e3c7c4.js";import"./@popperjs.f3f73334.js";const Ie=v=>(Le("data-v-af982f8c"),v=v(),Ee(),v),Ue={class:"container"},Be={style:{display:"flex",gap:"1rem","align-items":"flex-end"}},De={style:{"margin-right":"20px"}},Ve={style:{color:"#373737",margin:"10px"}},Se={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Pe={style:{display:"flex",width:"100%"}},Re={style:{width:"90%"}},ze=Ie(()=>m("br",null,null,-1)),Te={style:{width:"50%",margin:"auto","text-align":"center"}},je={name:"Backup"},Me=Ce({...je,setup(v){ee();const d=te(),D=ce(),s=U({binaryFile:void 0,loading:!1,showPanel:!1,showUpload:!1,refLoading:!1,myList:[],total:0,page:1,nowpage:[],title:""}),l=U({id:0,title:"",desc:"",firmware:[]});$e(async()=>{A({current:1})});const A=async n=>{s.page=n.current;const o=await h.get("https://k5ws.vicicode.cn/api/channel/index?server=1&limit=12&page="+n.current+"&title="+s.title+"&t="+Date.now());s.total=o.data.total,s.nowpage=o.data.list},w=async()=>{s.refLoading=!0,s.showPanel=!0;const n=await h.post("https://k5ws.vicicode.cn/api/channel/my?server=1",{},{headers:{"ba-user-token":d.accountId}});s.myList=n.data,s.refLoading=!1},V=()=>{l.id=0,l.title="",l.desc="",l.firmware=[],s.showUpload=!0},S=async()=>{var n;if(l.title==""||l.firmware.code==0){I.error({content:"\u672A\u586B\u5199\u540D\u79F0\u53CA\u4E0A\u4F20\u6587\u4EF6",duration:5*1e3});return}l.id===0?await h.post("https://k5ws.vicicode.cn/api/channel/add?server=1",{title:l.title,desc:l.desc,data:l.firmware[0].response.data.file.url},{headers:{"ba-user-token":d.accountId}}):await h.post("https://k5ws.vicicode.cn/api/channel/edit?server=1",{id:l.id,title:l.title,desc:l.desc,data:(n=l.firmware[0].url)!=null?n:l.firmware[0].response.data.file.url},{headers:{"ba-user-token":d.accountId}}),s.showUpload=!1,w()},P=async n=>{l.id=n,l.title=s.myList.filter(o=>o.id==n)[0].title,l.desc=s.myList.filter(o=>o.id==n)[0].desc,l.firmware=[{name:s.myList.filter(o=>o.id==n)[0].title,status:"success",url:s.myList.filter(o=>o.id==n)[0].file}],s.showUpload=!0},R=async n=>{await h.post("https://k5ws.vicicode.cn/api/channel/del?server=1",{id:n},{headers:{"ba-user-token":d.accountId}}),w()},z=async n=>{s.nowpage.filter(o=>{o.id==n&&(o.star+=1)}),await h.post("https://k5ws.vicicode.cn/api/channel/star?server=1",{id:n}),I.success({content:"\u70B9\u8D5E\u6210\u529F",duration:5*1e3})},T=()=>{w()},j=n=>{D.push({path:"/chirp/channel",query:{url:n}})},M=(n,o)=>{fetch(n).then(g=>g.blob()).then(g=>{const x=URL.createObjectURL(g),u=document.createElement("a");u.href=x,u.download=o+".xlsx",document.body.appendChild(u),u.click(),document.body.removeChild(u)})},$=()=>{A({current:1})};return(n,o)=>{const g=ae,x=_e,u=ne,f=fe,N=ie,q=re,H=se,J=he,O=le,Q=ue,G=de,C=we,L=ge,K=ke,W=ye,E=ve,b=xe,X=be,Y=Fe,Z=Ae;return c(),k("div",Ue,[a(g,{items:[n.$t("menu.workshop"),n.$t("menu.channel")]},null,8,["items"]),a(G,{gutter:20,align:"stretch"},{default:t(()=>[a(Q,{span:24},{default:t(()=>[a(O,{class:"general-card"},{title:t(()=>[m("div",Be,[i(r(n.$t("menu.channel"))+" ",1),a(x,{size:"small",style:{width:"200px"},modelValue:s.title,"onUpdate:modelValue":o[0]||(o[0]=e=>s.title=e),onEnter:$},{suffixIcon:t(()=>[a(p(pe),{style:{cursor:"pointer"},onClick:$})]),_:1},8,["modelValue"])])]),extra:t(()=>[m("div",De,[p(d).name?(c(),k(F,{key:0},[a(u,{onClick:w},{default:t(()=>[i("\xA0\xA0"+r(p(d).name)+"\xA0\xA0",1)]),_:1}),a(u,{onClick:w},{default:t(()=>[i("\xA0\xA0"+r(n.$t("global.upload"))+"\xA0\xA0",1)]),_:1}),a(u,{onClick:o[1]||(o[1]=e=>p(d).logout())},{default:t(()=>[i("\xA0\xA0"+r(n.$t("global.logout"))+"\xA0\xA0",1)]),_:1})],64)):(c(),k(F,{key:1},[a(u,{onClick:o[2]||(o[2]=e=>p(d).setInfo({showLogin:!0}))},{default:t(()=>[i("\xA0\xA0"+r(n.$t("global.login"))+"\xA0\xA0",1)]),_:1}),a(u,{onClick:o[3]||(o[3]=e=>p(d).setInfo({showRegister:!0}))},{default:t(()=>[i("\xA0\xA0"+r(n.$t("global.register"))+"\xA0\xA0",1)]),_:1}),m("span",Ve,r(n.$t("global.loginUpload")),1)],64))])]),default:t(()=>[a(H,null,{default:t(()=>[(c(!0),k(F,null,B(s.nowpage,e=>(c(),y(q,{style:{width:"100%"}},{actions:t(()=>[a(f,{style:{"margin-left":"1rem"}},{default:t(()=>[i(r(e.create_time_text),1)]),_:2},1024),a(u,{style:{"min-width":"100px"},onClick:_=>z(e.id)},{default:t(()=>[i("\u{1F44D}\uFF08"+r(e.star)+"\uFF09",1)]),_:2},1032,["onClick"]),a(u,{style:{"min-width":"70px"},onClick:_=>M("https://k5ws.vicicode.cn"+e.file,e.title)},{default:t(()=>[i(r(n.$t("global.download")),1)]),_:2},1032,["onClick"]),a(u,{style:{"min-width":"70px"},onClick:_=>j("https://k5ws.vicicode.cn"+e.file)},{default:t(()=>[i(r(n.$t("global.use")),1)]),_:2},1032,["onClick"])]),default:t(()=>[a(N,{description:e.desc},{title:t(()=>[a(f,{theme:"primary",variant:"outline"},{default:t(()=>{var _;return[i(r((_=e.user)==null?void 0:_.nickname),1)]}),_:2},1024),i(" "+r(e.title),1)]),_:2},1032,["description"])]),_:2},1024))),256))]),_:1}),a(J,{onChange:A,style:{margin:"10px"},total:s.total,current:s.page,pageSize:12,showPageNumber:"",showPageSize:!1},null,8,["total","current"])]),_:1})]),_:1})]),_:1}),a(E,{visible:s.showPanel,"onUpdate:visible":o[4]||(o[4]=e=>s.showPanel=e),size:"50%",header:"\u6211\u7684\u5206\u4EAB",footer:!1},{default:t(()=>[m("div",Se,[a(C,{style:{margin:"10px"},onClick:V},{default:t(()=>[i("\u4E0A\u4F20\u65B0\u5206\u4EAB")]),_:1}),a(C,{loading:s.refLoading,shape:"circle",theme:"outline",onClick:T},{icon:t(()=>[a(p(me))]),_:1},8,["loading"])]),a(W,{split:!0},{default:t(()=>[(c(!0),k(F,null,B(s.myList,e=>(c(),y(K,null,{default:t(()=>[m("div",Pe,[m("div",Re,[e.status==0?(c(),y(f,{key:0,theme:"primary",variant:"outline"},{default:t(()=>[i("\u5BA1\u6838\u4E2D"+r(e.remark&&`\uFF08${e.remark}\uFF09`),1)]),_:2},1024)):e.status==1?(c(),y(f,{key:1,theme:"primary",variant:"outline"},{default:t(()=>[i("\u5DF2\u5BA1\u6838"+r(e.remark&&`\uFF08${e.remark}\uFF09`),1)]),_:2},1024)):(c(),y(f,{key:2,theme:"primary",variant:"outline"},{default:t(()=>[i("\u5DF2\u9A73\u56DE"+r(e.remark&&`\uFF08${e.remark}\uFF09`),1)]),_:2},1024)),i(" "+r(e.title)+" ",1),ze,i(" "+r(e.desc),1)]),m("div",Te,[a(f,null,{default:t(()=>[i(r(e.create_time_text),1)]),_:2},1024),i("\xA0 "),a(L,{theme:"primary",hover:"color",onClick:_=>P(e.id)},{default:t(()=>[i("\u7F16\u8F91")]),_:2},1032,["onClick"]),i("\xA0 "),a(L,{theme:"primary",hover:"color",onClick:_=>R(e.id)},{default:t(()=>[i("\u5220\u9664")]),_:2},1032,["onClick"])])])]),_:2},1024))),256))]),_:1})]),_:1},8,["visible"]),a(E,{visible:s.showUpload,"onUpdate:visible":o[8]||(o[8]=e=>s.showUpload=e),size:"25%",header:"\u4E0A\u4F20\u65B0\u56FA\u4EF6",footer:!1},{default:t(()=>[a(Z,{data:l,"reset-type":"initial",colon:"",onSubmit:S},{default:t(()=>[a(b,{label:"\u5206\u4EAB\u540D\u79F0",name:"title","label-align":"top"},{default:t(()=>[a(x,{modelValue:l.title,"onUpdate:modelValue":o[5]||(o[5]=e=>l.title=e)},null,8,["modelValue"])]),_:1}),a(b,{label:"\u5206\u4EAB\u63CF\u8FF0",name:"desc","label-align":"top"},{default:t(()=>[a(X,{maxlength:200,autosize:{minRows:5,maxRows:10},modelValue:l.desc,"onUpdate:modelValue":o[6]||(o[6]=e=>l.desc=e),clearable:""},null,8,["modelValue"])]),_:1}),a(b,{label:"\u4FE1\u9053\u6587\u4EF6",name:"firmware","label-align":"top"},{default:t(()=>[a(Y,{modelValue:l.firmware,"onUpdate:modelValue":o[7]||(o[7]=e=>l.firmware=e),action:"https://k5ws.vicicode.cn/api/ajax/upload?server=1","abridge-name":[8,6],headers:{"ba-user-token":p(d).accountId},theme:"file-input",placeholder:"\u672A\u9009\u62E9\u6587\u4EF6"},null,8,["modelValue","headers"])]),_:1}),a(b,{"label-align":"top"},{default:t(()=>[a(C,{theme:"primary",type:"submit",block:""},{default:t(()=>[i("\u63D0\u4EA4\u5BA1\u6838")]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])])}}});const ft=oe(Me,[["__scopeId","data-v-af982f8c"]]);export{ft as default};
