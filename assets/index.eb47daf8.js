import{d as v,g as k,_ as D}from"./index.081d14fd.js";import{a6 as O,P as V,d as N,k as P,a7 as x,O as S,U as $,_ as R}from"./@arco-design.10d71e42.js";import"./vue.ffb667bf.js";import{u as T}from"./vue-router.a9f5d186.js";import{d as F,c as I,r as _,j as y,k as j,l as q,m as H}from"./serial.0b46e76d.js";import{D as M}from"./tdesign-vue-next.ed813ef2.js";import{d as U,h as K,l as L,o as z,a as G,x as n,u as r,b as c,z as d,A as E,D as g}from"./@vue.6ceb3fa6.js";import"./nprogress.6328d444.js";import"./@intlify.02b6985d.js";import"./mitt.550594b0.js";import"./pinia.fa8b6be2.js";import"./vue-demi.0e7683c7.js";import"./axios.06033baf.js";import"./vue-i18n.5fb6db72.js";import"./@vueuse.a7db99fe.js";import"./@zxing.8654f0db.js";import"./@microsoft.d2aaf3b7.js";import"./vue-matomo.5bdfe9a5.js";import"./b-tween.8dd4e2fe.js";import"./dayjs.35d19ede.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";import"./lodash-es.18922ecc.js";import"./sortablejs.77296005.js";import"./@popperjs.f3f73334.js";import"./@babel.9b6013fe.js";const W={class:"container"},J={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Q=["innerHTML"],X={name:"Flash"},Y=U({...X,setup(Z){const m=v(),t=K({status:"\u70B9\u51FB\u66F4\u65B0\u6309\u94AE\u66F4\u65B0\u56FA\u4EF6\u5230\u8BBE\u5907<br/><br/>",binaryFile:void 0,binaryName:"",protocol:"Official"}),l=T();L(async()=>{var a;if(l.query.url){const o=await fetch(l.query.url),i=(a=o==null?void 0:o.body)==null?void 0:a.getReader();if(i){const s=[];for(;;){const{done:p,value:f}=await i.read();if(p)break;s.push(...f)}const u=new Uint8Array(s);t.binaryFile=u,t.binaryName=l.query.url.substring(l.query.url.lastIndexOf("/")+1).split("?")[0]+" "}}const e=M.confirm({theme:"danger",header:"\u63D0\u793A",body:"\u6CC9\u76DB K5/K6 \u5F53\u524D\u5728\u552E\u4E24\u4E2A\u786C\u4EF6\u7248\u672C\uFF0C\u5982\u4F7F\u7528\u7B2C\u4E09\u65B9\u56FA\u4EF6\u8BF7\u5148\u4E0E\u5546\u5BB6\u786E\u8BA4\u53EF\u4EE5\u5347\u7EA7\u5230\u7B2C\u4E09\u65B9\u56FA\u4EF6\u3002",className:"t-dialog-new-class1 t-dialog-new-class2",style:"color: rgba(0, 0, 0, 0.6)",confirmBtn:"\u6211\u77E5\u9053\u4E86",cancelBtn:null,closeBtn:!1,onConfirm:()=>{e.destroy()},closeOnEscKeydown:!1,closeOnOverlayClick:!1})});const b=()=>{const e=document.createElement("input");e.type="file",e.onchange=async()=>{const a=new Blob([e.files[0]],{type:"application/octet-stream"}),o=new Uint8Array(await a.arrayBuffer());t.binaryFile=o,t.binaryName=e.files[0].name},e.click()},B=async()=>{if(t.protocol=="V2"){alert("\u6682\u672A\u652F\u6301 Coming Soon");return}if(!t.binaryFile){alert("\u8BF7\u9009\u62E9\u6587\u4EF6");return}m.connectPort&&await F(m.connectPort);let e=await I();t.protocol=="Official"&&await _(e,24,1e3),t.protocol=="Official"&&(await y(e,[48,5,16,0,42,79,69,70,87,45,76,79,83,69,72,85,0,0,0,0]),await _(e,24));const a=j(t.binaryFile);if(a.length>61440)throw alert("\u6700\u540E\u7684\u8FB9\u754C\u68C0\u67E5\u5931\u8D25\u3002\u4E0D\u7BA1\u662F\u8C01\u4FEE\u6539\u4E86\u4EE3\u7801\uFF0C\u4ED6\u90FD\u662F\u4E2A\u767D\u75F4\u3002"),new Error("Last resort boundary check failed. Whoever touched the code is an idiot.");for(let o=0;o<a.length;o+=256){const i=a.slice(o,o+256),s=q(i,o,a.length);try{await y(e,s),t.protocol=="Official"?await _(e,26):await H(e)}catch(u){return console.log("Flash command rejected. Aborting."),Promise.reject(u)}t.status=t.status+`\u66F4\u65B0\u8FDB\u5EA6 ${(o/a.length*100).toFixed(1)}%<br/>`,g(()=>{const u=document==null?void 0:document.getElementById("statusArea");u&&(u.scrollTop=u==null?void 0:u.scrollHeight)})}t.status=t.status+"\u66F4\u65B0\u8FDB\u5EA6 100.0%<br/>",t.status=t.status+"\u56FA\u4EF6\u66F4\u65B0\u6210\u529F",g(()=>{const o=document==null?void 0:document.getElementById("statusArea");o&&(o.scrollTop=o==null?void 0:o.scrollHeight)}),F(e),m.updateSettings({connectState:!1})};return(e,a)=>{const o=k,i=N,s=P,u=O,p=x,f=S,h=V,w=$,A=R;return z(),G("div",W,[n(o,{items:[e.$t("menu.list"),e.$t("menu.flash")]},null,8,["items"]),n(A,{gutter:20,align:"stretch"},{default:r(()=>[n(w,{span:24},{default:r(()=>[n(h,{class:"general-card",title:e.$t("menu.flash")+e.$t("global.onBoot")},{default:r(()=>[c("div",J,[c("div",null,[n(s,null,{default:r(()=>[n(i,{onClick:b},{default:r(()=>[d(E(t.binaryFile?t.binaryName:e.$t("tool.selectFirmware")),1)]),_:1}),n(i,{type:"primary",disabled:!t.binaryFile,onClick:B},{default:r(()=>[d(E(e.$t("tool.flash")),1)]),_:1},8,["disabled"])]),_:1})]),c("div",null,[n(p,{type:"button",size:"mini",modelValue:t.protocol,"onUpdate:modelValue":a[0]||(a[0]=C=>t.protocol=C)},{default:r(()=>[n(u,{value:"Official"},{default:r(()=>[...a[1]||(a[1]=[d("Official",-1)])]),_:1}),n(u,{value:"V2"},{default:r(()=>[...a[2]||(a[2]=[d("V2",-1)])]),_:1})]),_:1},8,["modelValue"])])]),n(f),c("div",{id:"statusArea",style:{height:"20em","background-color":"var(--color-bg-3)",color:"var(--color-text-3)",overflow:"auto",padding:"20px"},innerHTML:t.status},null,8,Q)]),_:1},8,["title"])]),_:1})]),_:1})])}}});const Ot=D(Y,[["__scopeId","data-v-fd2f2307"]]);export{Ot as default};
