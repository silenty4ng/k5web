import{d as U,g as V,_ as B}from"./index.5e564963.js";import{U as L,a2 as N,d as A,k as j,W as T,a0 as z}from"./@arco-design.282d06c8.js";import"./vue.ffb667bf.js";import{u as O}from"./vue-router.a9f5d186.js";import{e as q,b as H,g as K}from"./serial.0b46e76d.js";import{p as Q}from"./tdesign-vue-next.ed813ef2.js";import{d as W,h as G,l as J,o as _,a as b,x as p,u as g,b as w,F as E,Q as $,e as X,z as x,A as y}from"./@vue.6ceb3fa6.js";import"./nprogress.6328d444.js";import"./@intlify.02b6985d.js";import"./mitt.550594b0.js";import"./pinia.fa8b6be2.js";import"./vue-demi.0e7683c7.js";import"./axios.06033baf.js";import"./vue-i18n.5fb6db72.js";import"./@vueuse.a7db99fe.js";import"./@zxing.8654f0db.js";import"./@microsoft.d2aaf3b7.js";import"./vue-matomo.5bdfe9a5.js";import"./b-tween.8dd4e2fe.js";import"./dayjs.35d19ede.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";import"./lodash-es.18922ecc.js";import"./sortablejs.77296005.js";import"./@popperjs.f3f73334.js";import"./@babel.9b6013fe.js";const Y={class:"container"},Z={style:{padding:"0",margin:"0","border-spacing":"0"}},tt=["onMousedown","onMouseover"],et={name:"Image"},ot=W({...et,setup(nt){const f=U(),n=G({binaryFile:void 0,loading:!1,matrix:[],mousedown:!1,threshold:128,cache:void 0}),v=O();J(async()=>{if(v.query.url){const o=await fetch(v.query.url,{responseType:"blob"});D(window.URL.createObjectURL(await o.blob()))}});const k=()=>{const o=n.matrix;o.map((t,e)=>{t.map((a,i)=>{o[e][i]=a=="#fff"?"#000":"#fff"})}),n.matrix=o},I=(o,t)=>{if(n.mousedown){const e=n.matrix;e[t][o]=n.matrix[t][o]=="#fff"?"#000":"#fff",n.matrix=e}},D=o=>{const t=document.createElement("canvas");t.width=128,t.height=64;const e=t.cloneNode(),a=document.getElementById("canvasDiv");a.innerHTML="",a==null||a.append(t,e);const i=new Image;i.src=o,i.onload=()=>{const s=t.getContext("2d");s==null||s.drawImage(i,0,0,128,64);const c=s==null?void 0:s.getImageData(0,0,t.width,t.height).data;n.cache=c;function h(r,l){const d=(l*128+r)*4;return c[d]+c[d+1]+c[d+2]>n.threshold*3?0:1}const m=[];for(let r=0;r<64;r++){m.push([]),m[r]=[];for(let l=0;l<128;l++){const u=!h(l,r);m[r][l]=u?"#fff":"#000"}}n.matrix=m}},F=()=>{const o=document.createElement("input");o.type="file",o.onchange=async()=>{const t=new Blob([o.files[0]],{type:"application/octet-stream"}),e=URL.createObjectURL(t),a=document.createElement("canvas");a.width=128,a.height=64;const i=new Image;i.src=e,i.onload=()=>{const s=a.getContext("2d");s==null||s.drawImage(i,0,0,128,64);const c=s==null?void 0:s.getImageData(0,0,a.width,a.height).data;n.cache=c;function h(r,l){const d=(l*128+r)*4;return c[d]+c[d+1]+c[d+2]>n.threshold*3?0:1}const m=[];for(let r=0;r<64;r++){m.push([]),m[r]=[];for(let l=0;l<128;l++){const u=!h(l,r);m[r][l]=u?"#fff":"#000"}}n.matrix=m}},o.click()},P=async()=>{const o=n.matrix,t=document.createElement("canvas");t.width=128,t.height=64;const e=t.getContext("2d");e&&(e.fillStyle="#fff",e.fillRect(0,0,t.width,t.height),e.fillStyle="#000");for(let i=0;i<64;i++)for(let s=0;s<128;s++)o[i][s]=="#000"&&(e==null||e.beginPath(),e==null||e.rect(s,i,1,1),e==null||e.fill());const a=document.createElement("a");a.href=t.toDataURL("image/jpeg",1),a.download="image.jpg",a.click()},R=async()=>{var i,s,c,h,m;const o=new Uint8Array(1024);let t=0;for(let r=0;r<64;r+=8)for(let l=0;l<128;l++){let u=0;for(let d=0;d<8;d++)u|=(n.matrix[r+d][l]=="#000"?1:0)<<d;o[t++]=u}if(n.binaryFile=o,f.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}if(((i=f.configuration)==null?void 0:i.uart)=="official"){alert(sessionStorage.getItem("noticeVersionNoSupport"));return}if(((s=f.configuration)==null?void 0:s.charset)!="losehu"&&((c=f.configuration)==null?void 0:c.charset)!="gb2312"){alert(sessionStorage.getItem("noticeVersionNoSupport"));return}n.loading=!0;let e=123728;((h=f.configuration)==null?void 0:h.charset)=="gb2312"&&(e=8320),await q(f.connectPort);const a=n.binaryFile;for(let r=e;r<a.length+e;r+=64)await H(f.connectPort,r,a.slice(r-e,r-e+64),a.slice(r-e,r-e+64).length,(m=f.configuration)==null?void 0:m.uart);await K(f.connectPort),n.loading=!1},M=()=>{const o=n.cache;function t(a,i){const c=(i*128+a)*4;return o[c]+o[c+1]+o[c+2]>n.threshold*3?0:1}const e=[];for(let a=0;a<64;a++){e.push([]),e[a]=[];for(let i=0;i<128;i++){const s=!t(i,a);e[a][i]=s?"#fff":"#000"}}n.matrix=e};return(o,t)=>{const e=V,a=Q,i=A,s=j,c=L,h=N,m=T,r=z;return _(),b("div",Y,[p(e,{items:[o.$t("menu.list"),o.$t("menu.image")]},null,8,["items"]),p(r,{gutter:20,align:"stretch"},{default:g(()=>[p(m,{span:24},{default:g(()=>[p(h,{loading:n.loading,tip:"\u5199\u5165\u4E2D...",style:{width:"100%"}},{default:g(()=>[p(c,{class:"general-card",title:o.$t("menu.image")+o.$t("global.onStart")},{default:g(()=>[t[2]||(t[2]=w("div",{id:"canvasDiv",style:{zoom:"250%",display:"none"}},null,-1)),w("div",null,[w("table",Z,[(_(!0),b(E,null,$(n.matrix,(l,u)=>(_(),b("tr",null,[(_(!0),b(E,null,$(l,(d,S)=>(_(),b("td",{onMousedown:C=>{n.mousedown=!0,I(S,u)},onMouseup:t[0]||(t[0]=C=>{n.mousedown=!1}),onMouseover:C=>I(S,u),style:X("background-color: "+d+"; height: 5px; width: 3.5px;")},null,44,tt))),256))]))),256))])]),t[3]||(t[3]=w("br",null,null,-1)),t[4]||(t[4]=x(" \u8272\u5F69\u9608\u503C\uFF1A",-1)),p(a,{modelValue:n.threshold,"onUpdate:modelValue":t[1]||(t[1]=l=>n.threshold=l),max:256,style:{width:"200px"},onChangeEnd:M},null,8,["modelValue"]),t[5]||(t[5]=w("br",null,null,-1)),p(s,null,{default:g(()=>[p(i,{onClick:F},{default:g(()=>[x(y(o.$t("tool.selectImage")),1)]),_:1}),p(i,{disabled:n.matrix.length<64,onClick:k},{default:g(()=>[x(y(o.$t("image.negative")),1)]),_:1},8,["disabled"]),p(i,{disabled:n.matrix.length<64,onClick:P},{default:g(()=>[x(y(o.$t("cps.save")),1)]),_:1},8,["disabled"]),p(i,{type:"primary",disabled:n.matrix.length<64,onClick:R},{default:g(()=>[x(y(o.$t("tool.write")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["title"])]),_:1},8,["loading"])]),_:1})]),_:1})])}}});const Mt=B(ot,[["__scopeId","data-v-7b502477"]]);export{Mt as default};
