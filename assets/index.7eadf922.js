import{d as j,g as O,_ as T}from"./index.50b71120.js";import{P as z,a0 as q,d as G,k as H,U as K,_ as Q}from"./@arco-design.2114ce1c.js";import"./vue.ffb667bf.js";import{u as W}from"./vue-router.a9f5d186.js";import{e as V,g as $,i as F,d as J,k as X}from"./serial.3a8dd4af.js";import{p as Y}from"./tdesign-vue-next.ed813ef2.js";import{d as Z,h as tt,l as et,o as y,a as v,x as h,u as w,b as S,F as R,Q as U,e as ot,z as I,A as C}from"./@vue.6ceb3fa6.js";import"./nprogress.6328d444.js";import"./@intlify.02b6985d.js";import"./mitt.550594b0.js";import"./pinia.fa8b6be2.js";import"./vue-demi.0e7683c7.js";import"./axios.06033baf.js";import"./vue-i18n.5fb6db72.js";import"./@vueuse.a7db99fe.js";import"./@zxing.8654f0db.js";import"./@microsoft.d2aaf3b7.js";import"./vue-matomo.5bdfe9a5.js";import"./b-tween.8dd4e2fe.js";import"./dayjs.35d19ede.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";import"./lodash-es.18922ecc.js";import"./sortablejs.77296005.js";import"./@popperjs.f3f73334.js";import"./@babel.9b6013fe.js";const nt={class:"container"},at={style:{padding:"0",margin:"0","border-spacing":"0"}},it=["onMousedown","onMouseover"],rt={name:"Image"},st=Z({...rt,setup(lt){const m=j(),e=tt({binaryFile:void 0,loading:!1,matrix:[],mousedown:!1,threshold:128,cache:void 0}),E=W();et(async()=>{if(E.query.url){const o=await fetch(E.query.url,{responseType:"blob"});M(window.URL.createObjectURL(await o.blob()))}});const D=()=>{const o=e.matrix;o.map((t,n)=>{t.map((a,i)=>{o[n][i]=a=="#fff"?"#000":"#fff"})}),e.matrix=o},k=(o,t)=>{if(e.mousedown){const n=e.matrix;n[t][o]=e.matrix[t][o]=="#fff"?"#000":"#fff",e.matrix=n}},M=o=>{const t=document.createElement("canvas");t.width=128,t.height=64;const n=t.cloneNode(),a=document.getElementById("canvasDiv");a.innerHTML="",a==null||a.append(t,n);const i=new Image;i.src=o,i.onload=()=>{const r=t.getContext("2d");r==null||r.drawImage(i,0,0,128,64);const d=r==null?void 0:r.getImageData(0,0,t.width,t.height).data;e.cache=d;function b(s,l){const f=(l*128+s)*4;return d[f]+d[f+1]+d[f+2]>e.threshold*3?0:1}const u=[];for(let s=0;s<64;s++){u.push([]),u[s]=[];for(let l=0;l<128;l++){const g=!b(l,s);u[s][l]=g?"#fff":"#000"}}e.matrix=u}},B=()=>{const o=document.createElement("input");o.type="file",o.onchange=async()=>{const t=new Blob([o.files[0]],{type:"application/octet-stream"}),n=URL.createObjectURL(t),a=document.createElement("canvas");a.width=128,a.height=64;const i=new Image;i.src=n,i.onload=()=>{const r=a.getContext("2d");r==null||r.drawImage(i,0,0,128,64);const d=r==null?void 0:r.getImageData(0,0,a.width,a.height).data;e.cache=d;function b(s,l){const f=(l*128+s)*4;return d[f]+d[f+1]+d[f+2]>e.threshold*3?0:1}const u=[];for(let s=0;s<64;s++){u.push([]),u[s]=[];for(let l=0;l<128;l++){const g=!b(l,s);u[s][l]=g?"#fff":"#000"}}e.matrix=u}},o.click()},L=async()=>{const o=e.matrix,t=document.createElement("canvas");t.width=128,t.height=64;const n=t.getContext("2d");n&&(n.fillStyle="#fff",n.fillRect(0,0,t.width,t.height),n.fillStyle="#000");for(let i=0;i<64;i++)for(let r=0;r<128;r++)o[i][r]=="#000"&&(n==null||n.beginPath(),n==null||n.rect(r,i,1,1),n==null||n.fill());const a=document.createElement("a");a.href=t.toDataURL("image/jpeg",1),a.download="image.jpg",a.click()},N=async()=>{var r,d,b,u,s,l,g,f,x;const o=new Uint8Array(1024);let t=0;for(let c=0;c<64;c+=8)for(let p=0;p<128;p++){let _=0;for(let P=0;P<8;P++)_|=(e.matrix[c+P][p]=="#000"?1:0)<<P;o[t++]=_}if(e.binaryFile=o,m.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}if(((r=m.configuration)==null?void 0:r.uart)=="official"){if(((d=m.configuration)==null?void 0:d.charset)!="gb2312"){alert(sessionStorage.getItem("noticeVersionNoSupport"));return}e.loading=!0;let c=12288;await V(m.connectPort);let p=e.binaryFile;p=[90,90,188,154,0,4,255,255,...p];for(let _=c;_<p.length+c;_+=64)await $(m.connectPort,_,p.slice(_-c,_-c+64),p.slice(_-c,_-c+64).length,(b=m.configuration)==null?void 0:b.uart);await F(m.connectPort),e.loading=!1,await J(m.connectPort),m.updateSettings({connectState:!1,connectPort:null,firmwareVersion:""});return}if(((u=m.configuration)==null?void 0:u.charset)!="losehu"&&((s=m.configuration)==null?void 0:s.charset)!="gb2312"){alert(sessionStorage.getItem("noticeVersionNoSupport"));return}e.loading=!0;const n=((l=m.firmwareVersion)==null?void 0:l.startsWith("UVE"))&&((g=m.configuration)==null?void 0:g.charset)=="gb2312";let a=123728;((f=m.configuration)==null?void 0:f.charset)=="gb2312"&&(a=n?128:8320),await V(m.connectPort);const i=e.binaryFile;for(let c=a;c<i.length+a;c+=64){const p=i.slice(c-a,c-a+64);n?await X(m.connectPort,c,p,p.length):await $(m.connectPort,c,p,p.length,(x=m.configuration)==null?void 0:x.uart)}await F(m.connectPort),e.loading=!1},A=()=>{const o=e.cache;function t(a,i){const d=(i*128+a)*4;return o[d]+o[d+1]+o[d+2]>e.threshold*3?0:1}const n=[];for(let a=0;a<64;a++){n.push([]),n[a]=[];for(let i=0;i<128;i++){const r=!t(i,a);n[a][i]=r?"#fff":"#000"}}e.matrix=n};return(o,t)=>{const n=O,a=Y,i=G,r=H,d=z,b=q,u=K,s=Q;return y(),v("div",nt,[h(n,{items:[o.$t("menu.list"),o.$t("menu.image")]},null,8,["items"]),h(s,{gutter:20,align:"stretch"},{default:w(()=>[h(u,{span:24},{default:w(()=>[h(b,{loading:e.loading,tip:"\u5199\u5165\u4E2D...",style:{width:"100%"}},{default:w(()=>[h(d,{class:"general-card",title:o.$t("menu.image")+o.$t("global.onStart")},{default:w(()=>[t[2]||(t[2]=S("div",{id:"canvasDiv",style:{zoom:"250%",display:"none"}},null,-1)),S("div",null,[S("table",at,[(y(!0),v(R,null,U(e.matrix,(l,g)=>(y(),v("tr",null,[(y(!0),v(R,null,U(l,(f,x)=>(y(),v("td",{onMousedown:c=>{e.mousedown=!0,k(x,g)},onMouseup:t[0]||(t[0]=c=>{e.mousedown=!1}),onMouseover:c=>k(x,g),style:ot("background-color: "+f+"; height: 5px; width: 3.5px;")},null,44,it))),256))]))),256))])]),t[3]||(t[3]=S("br",null,null,-1)),t[4]||(t[4]=I(" \u8272\u5F69\u9608\u503C\uFF1A",-1)),h(a,{modelValue:e.threshold,"onUpdate:modelValue":t[1]||(t[1]=l=>e.threshold=l),max:256,style:{width:"200px"},onChangeEnd:A},null,8,["modelValue"]),t[5]||(t[5]=S("br",null,null,-1)),h(r,null,{default:w(()=>[h(i,{onClick:B},{default:w(()=>[I(C(o.$t("tool.selectImage")),1)]),_:1}),h(i,{disabled:e.matrix.length<64,onClick:D},{default:w(()=>[I(C(o.$t("image.negative")),1)]),_:1},8,["disabled"]),h(i,{disabled:e.matrix.length<64,onClick:L},{default:w(()=>[I(C(o.$t("cps.save")),1)]),_:1},8,["disabled"]),h(i,{type:"primary",disabled:e.matrix.length<64,onClick:N},{default:w(()=>[I(C(o.$t("tool.write")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["title"])]),_:1},8,["loading"])]),_:1})]),_:1})])}}});const Nt=T(st,[["__scopeId","data-v-baa337b9"]]);export{Nt as default};
