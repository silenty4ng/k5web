import{d as X,g as tt,_ as et}from"./index.df7295c8.js";import{ac as at,ad as ot,a8 as st,a4 as nt,a2 as lt,U as rt,M as it,f as ut,a3 as ct,ab as dt,d as pt,P as mt,W as ft,a0 as gt}from"./@arco-design.1f9a81c2.js";import"./vue.daf89c07.js";import{e as F,g as I,h as d,b as v,s as y}from"./serial.0b46e76d.js";import{u as _t}from"./loading.bfb45974.js";import{I as A,c as B,B as St,T as ht}from"./tdesign-vue-next.876353e4.js";import{d as bt,r as w,h as wt,c as Ft,l as yt,m as Ct,o as C,a as x,x as l,u as r,z as p,A as f,e as g,_ as Dt,N as Et,O as It,F as vt,Q as At,s as Bt,D as T,b9 as xt,b8 as Tt}from"./@vue.1cdd4af7.js";import"./vue-router.391082ef.js";import"./nprogress.b0a22fe3.js";import"./@intlify.d4358f23.js";import"./mitt.550594b0.js";import"./pinia.722f5e0f.js";import"./vue-demi.0f54e832.js";import"./axios.f3f20840.js";import"./vue-i18n.645f4f0b.js";import"./@vueuse.3623d212.js";import"./aegis-web-sdk.846094f8.js";import"./@zxing.8654f0db.js";import"./vue-matomo.4c7efa96.js";import"./b-tween.8dd4e2fe.js";import"./dayjs.f7934723.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";import"./lodash-es.18922ecc.js";import"./tdesign-icons-vue-next.5ef165be.js";import"./sortablejs.b2e3c7c4.js";import"./@popperjs.f3f73334.js";import"./@babel.9b6013fe.js";const kt=_=>(xt("data-v-20e3c5f8"),_=_(),Tt(),_),Ut={class:"container"},qt={style:{"text-align":"center"}},Nt=["src"],$t=kt(()=>g("br",null,null,-1)),Ot={style:{width:"100%"}},Rt=["innerHTML"],Mt={name:"Sat"},Vt=bt({...Mt,setup(_){const{loading:k,setLoading:m}=_t(!0),u=X();w(null),w(null),w(null);const a=wt({uuid:"",qrcode:"",visible:!1,showHide:0,status:"\u70B9\u51FB\u5199\u5165\u6309\u94AE\u5199\u5165\u536B\u661F\u6570\u636E\u5230\u8BBE\u5907<br/><br/>",sat:"",satData:[],lng:0,lat:0,alt:0,tx:0,rx:0,txTone:0,rxTone:0,CTCSSOption:[0,67,69.3,71.9,74.4,77,79.7,82.5,85.4,88.5,91.5,94.8,97.4,100,103.5,107.2,110.9,114.8,118.8,123,127.3,131.8,136.5,141.3,146.2,151.4,156.7,159.8,162.2,165.5,167.9,171.3,173.8,177.3,179.9,183.5,186.2,189.9,192.8,196.6,199.5,203.5,206.5,210.7,218.1,225.7,229.1,233.6,241.8,250.3,254.1],pass:void 0,passOption:[],dt:"",timer:void 0,passCustom:void 0,dtCustom:void 0,freqDb:[],selfSatModal:!1,selfSatInfo:"",satsData:[]}),U=t=>{const{row:e}=t;return e.status!==2},q=w(),N=Ft(()=>[{title:"\u536B\u661F\u540D\u79F0",colKey:"satName"},{title:"\u4E0A\u884C\u9891\u7387",colKey:"txFreq",align:"left",edit:{component:A,props:{clearable:!0,autofocus:!0},validateTrigger:"change",on:t=>({onBlur:()=>{console.log("\u5931\u53BB\u7126\u70B9",t)},onEnter:e=>{var s;(s=e==null?void 0:e.e)==null||s.preventDefault(),console.log("onEnter",e)}}),abortEditOnEvent:["onEnter"],onEdited:t=>{console.log(t);const e=[...a.satsData];e.splice(t.rowIndex,1,t.newRowData),a.satsData=e,console.log("Edit firstName:",t)},rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"}],defaultEditable:!0}},{title:"\u4E0A\u884C\u4E9A\u97F3",colKey:"txTone",edit:{component:B,props:{clearable:!0,options:a.CTCSSOption.map(t=>({label:t,value:t}))},on:t=>({onChange:e=>{console.log("status changed",t,e)}}),onEdited:t=>{a.satsData.splice(t.rowIndex,1,t.newRowData),console.log("Edit Framework:",t)}}},{title:"\u4E0B\u884C\u9891\u7387",colKey:"rxFreq",align:"left",edit:{component:A,props:{clearable:!0,autofocus:!0},validateTrigger:"change",on:t=>({onBlur:()=>{console.log("\u5931\u53BB\u7126\u70B9",t)},onEnter:e=>{var s;(s=e==null?void 0:e.e)==null||s.preventDefault(),console.log("onEnter",e)}}),abortEditOnEvent:["onEnter"],onEdited:t=>{console.log(t);const e=[...a.satsData];e.splice(t.rowIndex,1,t.newRowData),a.satsData=e,console.log("Edit firstName:",t)},rules:[{required:!0,message:"\u4E0D\u80FD\u4E3A\u7A7A"}],defaultEditable:!0}},{title:"\u4E0B\u884C\u4E9A\u97F3",colKey:"rxTone",edit:{component:B,props:{clearable:!0,options:a.CTCSSOption.map(t=>({label:t,value:t}))},on:t=>({onChange:e=>{console.log("status changed",t,e)}}),onEdited:t=>{a.satsData.splice(t.rowIndex,1,t.newRowData),console.log("Edit Framework:",t)}}}]);yt(async()=>{try{if(sessionStorage.getItem("satFrequenciesRst"))a.freqDb=JSON.parse(sessionStorage.getItem("satFrequenciesRst")||"[]");else{const t=await(await fetch("https://github.jobcher.com/gh/https://raw.githubusercontent.com/palewire/ham-satellite-database/main/data/amsat-active-frequencies.json")).text();a.freqDb=JSON.parse(t),sessionStorage.setItem("satFrequenciesRst",t)}}catch{}a.timer=setInterval(()=>{a.dt=new Date().toLocaleString(),localStorage.setItem("myLng",a.lng.toString()),localStorage.setItem("myLat",a.lat.toString()),localStorage.setItem("myAlt",a.alt.toString())},1e3)}),Ct(()=>{try{clearInterval(a.timer)}catch{}});const $=async()=>{if(u.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}m(!0),await F(u.connectPort),await D(),await I(u.connectPort),m(!1)},D=async()=>{var s;const t=a.dtCustom?new Date(a.dtCustom):new Date,e=[...d(parseInt(t.getUTCFullYear().toString().substring(2,4)).toString(16)),...d((t.getUTCMonth()+1).toString(16)),...d(t.getUTCDate().toString(16)),...d(t.getUTCHours().toString(16)),...d(t.getUTCMinutes().toString(16)),...d(t.getUTCSeconds().toString(16))];await v(u.connectPort,11168,new Uint8Array(e),6,(s=u.configuration)==null?void 0:s.uart)},O=async t=>{const e=a.satData.find(s=>s.name==t);if(e&&e.path){a.status+="<br/>\u536B\u661F\u53C2\u6570\uFF1A<br/>",e.path.map(o=>{a.status+=o+"<br/>"});let s=!1;a.freqDb.map(o=>{e.path[1].split(" ")[1]==o.norad_id&&o.mode.indexOf("FM")!=-1&&(console.log(o),s=!0,a.tx=o.uplink?parseFloat(o.uplink.split("/")[0]):0,a.rx=o.downlink?parseFloat(o.downlink.split("/")[0]):0,a.txTone=parseFloat(a.CTCSSOption.reduce((n,c)=>o.mode.indexOf(c)!=-1?c:n)))}),s||(a.tx=0,a.rx=0,a.txTone=0,a.rxTone=0),a.satsData.push({satName:t,line:e.path,txFreq:a.tx,txTone:a.txTone,rxFreq:a.rx,rxTone:a.rxTone}),console.log(a.satsData)}T(()=>{const s=document==null?void 0:document.getElementById("statusArea");s&&(s.scrollTop=s==null?void 0:s.scrollHeight)})};(async()=>{m(!0);let t="";sessionStorage.getItem("satRst")?t=sessionStorage.getItem("satRst")||"":(t=await(await fetch("https://celestrak.org/NORAD/elements/amateur.txt")).text(),sessionStorage.setItem("satRst",t));const e=t.split(/\r?\n/),s=[];let o={};for(let n=0;n<e.length;n++)Number.isNaN(parseInt(e[n].substring(0,1)))?(o.name&&o.name!=""&&(s.push(o),o={}),o.name=e[n]):(o.path||(o.path=[]),o.path.push(e[n]));a.satData=s,m(!1)})();const R=async()=>{const t=await(await fetch("https://k5.vicicode.cn/api/lol",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({func:1,uuid:a.uuid})})).json(),e=JSON.parse(t.cache);e.length>=3&&(a.lng=e[0],a.lat=e[1],a.alt=e[2])},M=async(t=0,e)=>{var s;await F(u.connectPort);for(let o=t;o<e.length+t;o+=64)await v(u.connectPort,o,e.slice(o-t,o-t+64),64,(s=u.configuration)==null?void 0:s.uart),a.status=a.status+"\u5199\u5165\u8FDB\u5EA6\uFF1A"+((o-t)/e.length*100).toFixed(1)+"%<br/>",T(()=>{const n=document==null?void 0:document.getElementById("statusArea");n&&(n.scrollTop=n==null?void 0:n.scrollHeight)});a.status=a.status+"\u5199\u5165\u8FDB\u5EA6\uFF1A100.0%<br/>"},V=t=>{const e=t.replace(/\d$/,"");let s=0;for(const o of e)o==="-"?s+=1:s+=parseInt(o,10)||0;return s%10},E=t=>{const e=parseInt(t[68],10),s=V(t);return e===s},L=async()=>{var s;if(u.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}if(((s=u.configuration)==null?void 0:s.sat2)!=!0){alert(sessionStorage.getItem("noticeVersionNoSupport"));return}m(!0),await F(u.connectPort);let t=new Uint8Array(160*45),e="";for(let o=0;o<a.satsData.length;o++){const n=a.satsData[o];t.set(y(n.satName).subarray(0,9),o*160),t.set(y(n.line[0]).subarray(0,69),o*160+9),E(n.line[0])||(e+=`\u7B2C ${o+1} \u884C\u536B\u661F\u661F\u5386\u7B2C\u4E00\u884C\u6570\u636E\u9519\u8BEF\uFF1B`),t.set(y(n.line[1]).subarray(0,69),o*160+9+69),E(n.line[1])||(e+=`\u7B2C ${o+1} \u884C\u536B\u661F\u661F\u5386\u7B2C\u4E8C\u884C\u6570\u636E\u9519\u8BEF\uFF1B`);const c=new Uint8Array(2);n.txTone&&n.txTone>0&&c.set(d(parseInt((n.txTone*10).toFixed(0)).toString(16)).subarray(0,2)),t.set(c,o*160+9+69+69);const S=new Uint8Array(2);n.rxTone&&n.rxTone>0&&S.set(d(parseInt((n.rxTone*10).toFixed(0)).toString(16)).subarray(0,2)),t.set(S,o*160+9+69+69+2);const h=new Uint8Array(4);h.set(d(parseInt((n.txFreq*1e6/10).toFixed(0)).toString(16))),t.set(h,o*160+9+69+69+2+2),parseInt((n.txFreq*1e6/10).toFixed(0))==0&&(e+=`\u7B2C ${o+1} \u884C\u536B\u661F\u7F3A\u5C11\u4E0A\u884C\u9891\u7387\uFF1B`);const b=new Uint8Array(4);b.set(d(parseInt((n.rxFreq*1e6/10).toFixed(0)).toString(16))),t.set(b,o*160+9+69+69+2+2+4),parseInt((n.rxFreq*1e6/10).toFixed(0))==0&&(e+=`\u7B2C ${o+1} \u884C\u536B\u661F\u7F3A\u5C11\u4E0B\u884C\u9891\u7387\uFF1B`)}if(e!="")return m(!1),it.error({content:e,duration:10*1e3});await M(123392,t),await D(),await I(u.connectPort),m(!1)},z=t=>!!new RegExp("^(https?:\\/\\/)?((([a-zA-Z\\d]([a-zA-Z\\d-]*[a-zA-Z\\d])*)\\.)+[a-zA-Z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-zA-Z\\d%_.~+]*)*(\\?[;&a-zA-Z\\d%_.~+=-]*)?(\\#[-a-zA-Z\\d_]*)?$","i").test(t),H=async()=>{z(a.selfSatInfo)&&(a.selfSatInfo=await(await fetch(a.selfSatInfo)).text());const t=(a.selfSatInfo+`
`).split(/\r?\n/),e=[];let s={};for(let o=0;o<t.length;o++)Number.isNaN(parseInt(t[o].substring(0,1)))?(s.name&&s.name!=""&&(e.push(s),s={}),s.name=t[o]):(s.path||(s.path=[]),s.path.push(t[o]));a.satData=e.concat(a.satData),a.selfSatInfo=""};return(t,e)=>{const s=at,o=ut,n=tt,c=ct,S=ot,h=St,b=dt,P=st,Z=nt,K=ht,Y=pt,j=mt,J=lt,Q=rt,W=ft,G=gt;return C(),x("div",Ut,[l(o,{width:"650px",visible:a.selfSatModal,"onUpdate:visible":e[1]||(e[1]=i=>a.selfSatModal=i),onOk:H},{title:r(()=>[p(f(t.$t("sat.selfSatInfo")),1)]),default:r(()=>[g("div",null,[l(s,{modelValue:a.selfSatInfo,"onUpdate:modelValue":e[0]||(e[0]=i=>a.selfSatInfo=i),style:{height:"120px"},placeholder:`ISS (ZARYA)             \r
  1 25544U 98067A   24320.36274227  .00015569  00000+0  28188-3 0  9999\r
  2 25544  51.6413 286.4173 0007936 217.3657 298.3197 15.49809951481990`},null,8,["modelValue"])])]),_:1},8,["visible"]),l(o,{visible:a.visible,"onUpdate:visible":e[2]||(e[2]=i=>a.visible=i),onOk:R,"ok-text":t.$t("tool.scaned")},{title:r(()=>[p(f(t.$t("tool.scanqr")),1)]),default:r(()=>[g("div",qt,[g("img",{src:a.qrcode},null,8,Nt),$t,p(" "+f(t.$t("tool.scannotice")),1)])]),_:1},8,["visible","ok-text"]),l(n,{items:[t.$t("menu.list"),t.$t("menu.satellite2")]},null,8,["items"]),l(G,{gutter:20,align:"stretch"},{default:r(()=>[l(W,{span:24},{default:r(()=>[l(Q,{class:"general-card",title:t.$t("menu.satellite2")+t.$t("global.onStart")},{default:r(()=>[l(J,{loading:Dt(k),style:{width:"100%"},tip:"\u6B63\u5728\u5904\u7406 ..."},{default:r(()=>[l(c,{"label-col-style":{width:"25%"},field:"dt",label:t.$t("tool.brtime"),onClick:e[3]||(e[3]=()=>{a.showHide+=1})},{default:r(()=>[p(f(a.dt),1)]),_:1},8,["label"]),Et(l(c,{"label-col-style":{width:"25%"},field:"dtCustom",label:"\u81EA\u5B9A\u4E49\u65F6\u95F4"},{default:r(()=>[g("div",null,[l(S,{style:{width:"220px",margin:"0 24px 24px 0"},"show-time":"","time-picker-props":{defaultValue:"00:00:00"},format:"YYYY-MM-DD HH:mm:ss",modelValue:a.dtCustom,"onUpdate:modelValue":e[4]||(e[4]=i=>a.dtCustom=i)},null,8,["modelValue"]),p(" \xA0\xA0"),l(h,{size:"small",theme:"success",onClick:$},{default:r(()=>[p("\u5199\u5165\u65F6\u95F4\u5230\u53F0\u7AD9")]),_:1})])]),_:1},512),[[It,a.showHide>=5]]),l(c,{"label-col-style":{width:"25%"},field:"sat",label:t.$t("tool.selectSatellite")},{default:r(()=>[g("div",Ot,[l(P,{modelValue:a.sat,"onUpdate:modelValue":e[5]||(e[5]=i=>a.sat=i),onChange:O,placeholder:t.$t("tool.selectSatellite")+"...","allow-search":"","allow-clear":""},{default:r(()=>[(C(!0),x(vt,null,At(a.satData,i=>(C(),Bt(b,{key:i.name,value:i.name},{default:r(()=>[p(f(i.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","placeholder"]),l(Z,{onClick:e[6]||(e[6]=()=>{a.selfSatModal=!0}),style:{"margin-top":"10px"}},{default:r(()=>[p(f(t.$t("sat.addSelfSat")),1)]),_:1})])]),_:1},8,["label"]),l(c,{"label-col-style":{width:"25%"},field:"sat",label:""},{default:r(()=>[l(K,{ref_key:"tableRef",ref:q,"row-key":"key",columns:N.value,data:a.satsData,"editable-cell-state":U,bordered:"","lazy-load":""},null,8,["columns","data"])]),_:1}),l(c,{"label-col-style":{width:"25%"},label:""},{default:r(()=>[l(Y,{type:"primary",onClick:L},{default:r(()=>[p(f(t.$t("tool.writeData")),1)]),_:1})]),_:1}),l(j),g("div",{id:"statusArea",style:{height:"20em","background-color":"var(--color-bg-3)",color:"var(--color-text-3)",overflow:"auto",padding:"20px"},innerHTML:a.status},null,8,Rt)]),_:1},8,["loading"])]),_:1},8,["title"])]),_:1})]),_:1})])}}});const be=et(Vt,[["__scopeId","data-v-20e3c5f8"]]);export{be as default};
