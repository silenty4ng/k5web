import{d as ae,u as oe,g as ne,_ as se}from"./index.83ff881e.js";import{a4 as le,U as ie,M as B,W as re,a0 as ue}from"./@arco-design.1f9a81c2.js";import"./vue.daf89c07.js";import{b as de}from"./vue-router.391082ef.js";import{a as _}from"./axios.f3f20840.js";import{J as ce,L as pe,N as me,K as _e}from"./tdesign-icons-vue-next.5ef165be.js";import{I as fe,B as ge,n as he,R as we,o as ve,P as ke,i as ye,L as xe,j as be,k as Fe,l as Ae,F as De,m as Ce,U as Ie,a as Ee}from"./tdesign-vue-next.876353e4.js";import{d as $e,h as L,l as Ue,o as d,a as v,x as e,u as t,e as p,z as l,A as r,_ as c,F,Q as V,s as k,b9 as Be,b8 as Le}from"./@vue.1cdd4af7.js";import"./nprogress.b0a22fe3.js";import"./@intlify.d4358f23.js";import"./mitt.550594b0.js";import"./pinia.722f5e0f.js";import"./vue-demi.0f54e832.js";import"./vue-i18n.645f4f0b.js";import"./@vueuse.3623d212.js";import"./aegis-web-sdk.846094f8.js";import"./@zxing.8654f0db.js";import"./vue-matomo.4c7efa96.js";import"./b-tween.8dd4e2fe.js";import"./dayjs.f7934723.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";import"./lodash-es.18922ecc.js";import"./sortablejs.b2e3c7c4.js";import"./@popperjs.f3f73334.js";import"./@babel.9b6013fe.js";const Ve=y=>(Be("data-v-bc51700c"),y=y(),Le(),y),ze={class:"container"},Se={style:{display:"flex",gap:"1rem","align-items":"flex-end"}},Pe={style:{"margin-right":"20px"}},Re={style:{color:"#373737",margin:"10px"}},je={style:{display:"block",position:"absolute","background-color":"rgba(0, 0, 0, 0.3)","min-width":"80px",color:"white","padding-left":"10px","padding-right":"10px","font-size":"0.9rem"}},Te=["title","src"],Ne={style:{display:"flex","align-items":"center","justify-content":"space-between"}},qe={style:{display:"flex",width:"100%"}},Me={style:{width:"90%"}},Je=Ve(()=>p("br",null,null,-1)),Ke={style:{width:"40%",margin:"auto","text-align":"center"}},Oe={name:"Backup"},Qe=$e({...Oe,setup(y){ae();const u=oe(),z=de(),s=L({binaryFile:void 0,loading:!1,showPanel:!1,showUpload:!1,refLoading:!1,myList:[],total:0,page:1,nowpage:[],dropzoneActive:!1,title:""}),S=o=>{o.preventDefault(),s.dropzoneActive=!0},P=o=>{o.preventDefault(),s.dropzoneActive=!1},R=o=>{o.preventDefault()},j=async o=>{o.preventDefault(),s.dropzoneActive=!1;const n=o.dataTransfer.files;for(let g=0;g<n.length;g++){const h=new FormData;h.append("file",n[g]);let m=await _.post("https://k5ws.vicicode.cn/api/ajax/upload?server=1",h,{headers:{"ba-user-token":u.accountId}});await _.post("https://k5ws.vicicode.cn/api/image/add?server=1",{title:n[g].name,desc:"",image:m.data.file.url},{headers:{"ba-user-token":u.accountId}}),f()}},i=L({title:"",desc:"",firmware:[]});Ue(async()=>{A({current:1})});const A=async o=>{s.page=o.current;const n=await _.get("https://k5ws.vicicode.cn/api/image/index?server=1&limit=24&page="+o.current+"&title="+s.title+"&t="+Date.now());s.total=n.data.total,s.nowpage=n.data.list},f=async()=>{s.refLoading=!0,s.showPanel=!0;const o=await _.post("https://k5ws.vicicode.cn/api/image/my?server=1",{},{headers:{"ba-user-token":u.accountId}});s.myList=o.data,s.refLoading=!1},T=()=>{i.title="",i.desc="",i.firmware=[],s.showUpload=!0},N=async()=>{if(i.title==""||i.firmware.length==0){B.error({content:"\u672A\u586B\u5199\u540D\u79F0\u53CA\u4E0A\u4F20\u6587\u4EF6",duration:5*1e3});return}await _.post("https://k5ws.vicicode.cn/api/image/add?server=1",{title:i.title,desc:i.desc,data:i.firmware[0].response.data.file.url},{headers:{"ba-user-token":u.accountId}}),s.showUpload=!1,f()},q=async o=>{await _.post("https://k5ws.vicicode.cn/api/image/del?server=1",{id:o},{headers:{"ba-user-token":u.accountId}}),f()},M=async o=>{s.nowpage.filter(n=>{n.id==o&&(n.star+=1)}),await _.post("https://k5ws.vicicode.cn/api/image/star?server=1",{id:o}),B.success({content:"\u70B9\u8D5E\u6210\u529F",duration:5*1e3})},J=()=>{f()},K=o=>{z.push({path:"/tool/image",query:{url:o}})},D=()=>{A({current:1})};return(o,n)=>{const g=ne,h=fe,m=le,w=ge,C=he,O=we,Q=ve,I=re,E=ue,W=ke,G=ie,x=ye,H=xe,X=be,Y=Fe,$=Ae,b=De,Z=Ce,ee=Ie,te=Ee;return d(),v("div",ze,[e(g,{items:[o.$t("menu.workshop"),o.$t("menu.image")]},null,8,["items"]),e(E,{gutter:20,align:"stretch"},{default:t(()=>[e(I,{span:24},{default:t(()=>[e(G,{class:"general-card"},{title:t(()=>[p("div",Se,[l(r(o.$t("menu.image"))+" ",1),e(h,{size:"small",style:{width:"200px"},modelValue:s.title,"onUpdate:modelValue":n[0]||(n[0]=a=>s.title=a),onEnter:D},{suffixIcon:t(()=>[e(c(ce),{style:{cursor:"pointer"},onClick:D})]),_:1},8,["modelValue"])])]),extra:t(()=>[p("div",Pe,[c(u).name?(d(),v(F,{key:0},[e(m,{onClick:f},{default:t(()=>[l("\xA0\xA0"+r(c(u).name)+"\xA0\xA0",1)]),_:1}),e(m,{onClick:f},{default:t(()=>[l("\xA0\xA0"+r(o.$t("global.upload"))+"\xA0\xA0",1)]),_:1}),e(m,{onClick:n[1]||(n[1]=a=>c(u).logout())},{default:t(()=>[l("\xA0\xA0"+r(o.$t("global.logout"))+"\xA0\xA0",1)]),_:1})],64)):(d(),v(F,{key:1},[e(m,{onClick:n[2]||(n[2]=a=>c(u).setInfo({showLogin:!0}))},{default:t(()=>[l("\xA0\xA0"+r(o.$t("global.login"))+"\xA0\xA0",1)]),_:1}),e(m,{onClick:n[3]||(n[3]=a=>c(u).setInfo({showRegister:!0}))},{default:t(()=>[l("\xA0\xA0"+r(o.$t("global.register"))+"\xA0\xA0",1)]),_:1}),p("span",Re,r(o.$t("global.loginUpload")),1)],64))])]),default:t(()=>[e(E,{gutter:20},{default:t(()=>[(d(!0),v(F,null,V(s.nowpage,a=>(d(),k(I,{span:4},{default:t(()=>[e(Q,{style:{width:"100%",marginBottom:"10px"}},{cover:t(()=>[p("div",je," \u70B9\u8D5E\uFF1A"+r(a.star),1),p("img",{style:{height:"6.75vw"},title:a.title+" ["+a.user.nickname+"]",src:"https://k5ws.vicicode.cn"+a.image},null,8,Te)]),footer:t(()=>[e(O,{align:"middle",justify:"center",style:{gap:"24px"}},{default:t(()=>[e(C,{flex:"auto",style:{display:"inline-flex","justify-content":"center"}},{default:t(()=>[e(w,{variant:"text",shape:"square",onClick:U=>M(a.id)},{default:t(()=>[e(c(pe))]),_:2},1032,["onClick"])]),_:2},1024),e(C,{flex:"auto",style:{display:"inline-flex","justify-content":"center"}},{default:t(()=>[e(w,{variant:"text",shape:"square",onClick:U=>K("https://k5ws.vicicode.cn"+a.image)},{default:t(()=>[e(c(me))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1}),e(W,{onChange:A,style:{margin:"10px"},total:s.total,current:s.page,pageSize:24,showPageNumber:"",showPageSize:!1},null,8,["total","current"])]),_:1})]),_:1})]),_:1}),e($,{visible:s.showPanel,"onUpdate:visible":n[4]||(n[4]=a=>s.showPanel=a),size:"50%",header:"\u6211\u7684\u56FE\u7247",footer:!1,onDragenter:S,onDragleave:P,onDragover:R,onDrop:j},{default:t(()=>[p("div",Ne,[e(w,{style:{margin:"10px"},onClick:T},{default:t(()=>[l("\u4E0A\u4F20\u65B0\u56FE\u7247")]),_:1}),e(w,{loading:s.refLoading,shape:"circle",theme:"outline",onClick:J},{icon:t(()=>[e(c(_e))]),_:1},8,["loading"])]),e(Y,{split:!0},{default:t(()=>[(d(!0),v(F,null,V(s.myList,a=>(d(),k(X,null,{default:t(()=>[p("div",qe,[p("div",Me,[a.status==0?(d(),k(x,{key:0,theme:"primary",variant:"outline"},{default:t(()=>[l("\u5BA1\u6838\u4E2D"+r(a.remark&&`\uFF08${a.remark}\uFF09`),1)]),_:2},1024)):a.status==1?(d(),k(x,{key:1,theme:"primary",variant:"outline"},{default:t(()=>[l("\u5DF2\u5BA1\u6838"+r(a.remark&&`\uFF08${a.remark}\uFF09`),1)]),_:2},1024)):(d(),k(x,{key:2,theme:"primary",variant:"outline"},{default:t(()=>[l("\u5DF2\u9A73\u56DE"+r(a.remark&&`\uFF08${a.remark}\uFF09`),1)]),_:2},1024)),l(" "+r(a.title)+" ",1),Je,l(" "+r(a.desc),1)]),p("div",Ke,[e(x,null,{default:t(()=>[l(r(a.create_time_text),1)]),_:2},1024),l("\xA0 "),e(H,{theme:"primary",hover:"color",onClick:U=>q(a.id)},{default:t(()=>[l("\u5220\u9664")]),_:2},1032,["onClick"])])])]),_:2},1024))),256))]),_:1})]),_:1},8,["visible"]),e($,{visible:s.showUpload,"onUpdate:visible":n[8]||(n[8]=a=>s.showUpload=a),size:"25%",header:"\u4E0A\u4F20\u65B0\u56FE\u7247",footer:!1},{default:t(()=>[e(te,{data:i,"reset-type":"initial",colon:"",onSubmit:N},{default:t(()=>[e(b,{label:"\u56FE\u7247\u540D\u79F0",name:"title","label-align":"top"},{default:t(()=>[e(h,{modelValue:i.title,"onUpdate:modelValue":n[5]||(n[5]=a=>i.title=a)},null,8,["modelValue"])]),_:1}),e(b,{label:"\u56FE\u7247\u63CF\u8FF0",name:"desc","label-align":"top"},{default:t(()=>[e(Z,{autosize:{minRows:5,maxRows:10},modelValue:i.desc,"onUpdate:modelValue":n[6]||(n[6]=a=>i.desc=a),clearable:""},null,8,["modelValue"])]),_:1}),e(b,{label:"\u56FE\u7247\u6587\u4EF6",name:"firmware","label-align":"top"},{default:t(()=>[e(ee,{modelValue:i.firmware,"onUpdate:modelValue":n[7]||(n[7]=a=>i.firmware=a),action:"https://k5ws.vicicode.cn/api/ajax/upload?server=1","abridge-name":[8,6],headers:{"ba-user-token":c(u).accountId},theme:"file-input",placeholder:"\u672A\u9009\u62E9\u6587\u4EF6"},null,8,["modelValue","headers"])]),_:1}),e(b,{"label-align":"top"},{default:t(()=>[e(w,{theme:"primary",type:"submit",block:""},{default:t(()=>[l("\u63D0\u4EA4\u5BA1\u6838")]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])])}}});const bt=se(Qe,[["__scopeId","data-v-bc51700c"]]);export{bt as default};
