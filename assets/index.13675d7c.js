import{d as M,g as z,_ as L}from"./index.09b560e5.js";import{$ as N,a8 as j,a9 as q,P as G,d as J,k as Q,aa as W,ab as X,O as Y,U as Z,_ as x}from"./@arco-design.10d71e42.js";import"./vue.ffb667bf.js";import{a as C,g as E,i as h,e as F,b as tt}from"./serial.c4ab9612.js";import{b as et}from"./tdesign-vue-next.ed813ef2.js";import{d as ot,h as at,o as nt,a as rt,x as o,u as n,b as T,A as s,z as m,N as it,O as lt,D as _}from"./@vue.6ceb3fa6.js";import"./vue-router.a9f5d186.js";import"./nprogress.6328d444.js";import"./@intlify.02b6985d.js";import"./mitt.550594b0.js";import"./pinia.fa8b6be2.js";import"./vue-demi.0e7683c7.js";import"./axios.06033baf.js";import"./vue-i18n.5fb6db72.js";import"./@vueuse.a7db99fe.js";import"./@zxing.8654f0db.js";import"./@microsoft.d2aaf3b7.js";import"./vue-matomo.5bdfe9a5.js";import"./b-tween.8dd4e2fe.js";import"./dayjs.35d19ede.js";import"./b-validate.1fdaeb97.js";import"./number-precision.5cddbed2.js";import"./resize-observer-polyfill.2b976e6e.js";import"./scroll-into-view-if-needed.0a5da943.js";import"./compute-scroll-into-view.17358474.js";import"./lodash-es.18922ecc.js";import"./sortablejs.77296005.js";import"./@popperjs.f3f73334.js";import"./@babel.9b6013fe.js";const st={class:"container"},ct=["innerHTML"],ut={name:"Backup"},pt=ot({...ut,setup(mt){const r=M(),e=at({status:"\u70B9\u51FB\u5907\u4EFD\u6309\u94AE\u5C06\u751F\u6210 EEPROM \u5907\u4EFD\u6587\u4EF6<br/><br/>",eepromType:"",showHide:0,startInfo:"0x00",showDialog:!1,dialogTitle:1}),$=()=>{if(e.dialogTitle>=3){e.showDialog=!1,D();return}e.dialogTitle+=1},S=()=>{e.dialogTitle=1,e.showDialog=!0},A=async()=>{var a;if(r.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}switch(await C(r.connectPort,(a=r.configuration)==null?void 0:a.uart)){case 8192:e.eepromType="1";break;case 65536:e.eepromType="5";break;case 131072:e.eepromType="2";break;case 262144:e.eepromType="3";break;case 524288:e.eepromType="4";break}},D=async()=>{var d,l;if(r.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}const t=await C(r.connectPort,(d=r.configuration)==null?void 0:d.uart);let a=new Uint8Array(64).fill(255);for(let c=0;c<t;c+=64)await E(r.connectPort,c,a,64,(l=r.configuration)==null?void 0:l.uart),e.status=e.status+"\u6E05\u7A7A\u8FDB\u5EA6\uFF1A"+((c-0)/t*100).toFixed(1)+"%<br/>",_(()=>{const i=document==null?void 0:document.getElementById("statusArea");i&&(i.scrollTop=i==null?void 0:i.scrollHeight)});await h(r.connectPort)},y=async(t,a,d=new Date+"_backup.bin")=>{var f;await F(r.connectPort);let l=new Uint8Array(a-t);for(let p=t;p<a;p+=64){const w=await tt(r.connectPort,p,64,(f=r.configuration)==null?void 0:f.uart);l.set(w,p-t),e.status=e.status+"\u5907\u4EFD\u8FDB\u5EA6\uFF1A"+((p-t)/l.length*100).toFixed(1)+"%<br/>",_(()=>{const b=document==null?void 0:document.getElementById("statusArea");b&&(b.scrollTop=b==null?void 0:b.scrollHeight)})}e.status=e.status+"\u5907\u4EFD\u8FDB\u5EA6\uFF1A100.0%<br/>",_(()=>{const p=document==null?void 0:document.getElementById("statusArea");p&&(p.scrollTop=p==null?void 0:p.scrollHeight)}),console.log(l);const c=new Blob([l],{type:"application/octet-stream"}),i=URL.createObjectURL(c),u=document.createElement("a");u.href=i,u.download=d,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(i)},k=async(t=0)=>{await F(r.connectPort);const a=document.createElement("input");a.type="file",a.accept=".bin",a.onchange=async()=>{var c;const d=new Blob([a.files[0]],{type:"application/octet-stream"}),l=new Uint8Array(await d.arrayBuffer());for(let i=t;i<a.files[0].size+t;i+=64)await E(r.connectPort,i,l.slice(i-t,i-t+64),l.slice(i-t,i-t+64).length,(c=r.configuration)==null?void 0:c.uart),e.status=e.status+"\u6062\u590D\u8FDB\u5EA6\uFF1A"+((i-t)/a.files[0].size*100).toFixed(1)+"%<br/>",_(()=>{const u=document==null?void 0:document.getElementById("statusArea");u&&(u.scrollTop=u==null?void 0:u.scrollHeight)});e.status=e.status+"\u6062\u590D\u8FDB\u5EA6\uFF1A100.0%<br/>",await h(r.connectPort)},a.click()},v=async()=>{if(r.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}await y(0,7680,"config.bin")},B=async()=>{if(r.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}await y(7680,8192,"calibration.bin")},I=async()=>{if(r.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}await k()},P=async()=>{if(r.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}await k(7680)},R=async()=>{var a;if(r.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}let t=8192;switch(e.eepromType){case"1":t=8192;break;case"2":t=131072;break;case"3":t=262144;break;case"4":t=524288;break;case"5":t=65536;break;default:t=8192}if(((a=r.configuration)==null?void 0:a.uart)=="official"&&t>=131072){alert("\u8BE5\u56FA\u4EF6\u4E0D\u652F\u6301\u5907\u4EFD\u6269\u5BB9\u7A7A\u95F4");return}await y(0,t)},U=async()=>{if(r.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}await k(parseInt(e.startInfo))};return(t,a)=>{const d=z,l=J,c=Q,i=W,u=N,f=X,p=j,w=q,b=Y,O=G,H=Z,V=x,K=et;return nt(),rt("div",st,[o(d,{items:[t.$t("menu.list"),t.$t("menu.rb")]},null,8,["items"]),o(V,{gutter:20,align:"stretch"},{default:n(()=>[o(H,{span:24},{default:n(()=>[o(O,{class:"general-card"},{title:n(()=>[T("span",{onClick:a[0]||(a[0]=()=>{e.showHide+=1})},s(t.$t("menu.rb")+t.$t("global.onStart")),1)]),default:n(()=>[o(w,{"default-active-key":"1"},{default:n(()=>[o(i,{key:"1",title:t.$t("tool.quickbackup")},{default:n(()=>[o(c,null,{default:n(()=>[o(l,{type:"primary",onClick:v},{default:n(()=>[m(s(t.$t("tool.backupConfig")),1)]),_:1}),o(l,{onClick:I},{default:n(()=>[m(s(t.$t("tool.restoreConfig")),1)]),_:1}),o(l,{type:"primary",onClick:B},{default:n(()=>[m(s(t.$t("tool.backupCalibration")),1)]),_:1}),o(l,{onClick:P},{default:n(()=>[m(s(t.$t("tool.restoreCalibration")),1)]),_:1})]),_:1})]),_:1},8,["title"]),o(i,{key:"2",title:t.$t("tool.fullbackup")},{default:n(()=>[o(c,null,{default:n(()=>[o(l,{type:"primary",onClick:R},{default:n(()=>[m(s(t.$t("tool.backup")),1)]),_:1}),it(o(u,{modelValue:e.startInfo,"onUpdate:modelValue":a[1]||(a[1]=g=>e.startInfo=g)},null,8,["modelValue"]),[[lt,e.showHide>=5]]),o(l,{onClick:U},{default:n(()=>[m(s(t.$t("tool.restore")),1)]),_:1}),o(p,{modelValue:e.eepromType,"onUpdate:modelValue":a[2]||(a[2]=g=>e.eepromType=g),style:{width:"320px"},placeholder:t.$t("tool.selectSize")},{default:n(()=>[o(f,{value:"1"},{default:n(()=>[m(s(t.$t("global.8kb")),1)]),_:1}),o(f,{value:"5"},{default:n(()=>[m(s(t.$t("global.64kb")),1)]),_:1}),o(f,{value:"2"},{default:n(()=>[m(s(t.$t("global.128kb")),1)]),_:1}),o(f,{value:"3"},{default:n(()=>[m(s(t.$t("global.256kb")),1)]),_:1}),o(f,{value:"4"},{default:n(()=>[m(s(t.$t("global.512kb")),1)]),_:1})]),_:1},8,["modelValue","placeholder"]),o(l,{type:"text",onClick:A},{default:n(()=>[m(s(t.$t("tool.autocheck")),1)]),_:1})]),_:1})]),_:1},8,["title"]),o(i,{key:"3",title:t.$t("tool.cleardata")},{default:n(()=>[o(c,null,{default:n(()=>[o(l,{type:"primary",onClick:S},{default:n(()=>[m(s(t.$t("tool.cleardata")),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1}),o(b),T("div",{id:"statusArea",style:{height:"20em","background-color":"var(--color-bg-3)",color:"var(--color-text-3)",overflow:"auto",padding:"20px"},innerHTML:e.status},null,8,ct)]),_:1})]),_:1})]),_:1}),o(K,{visible:e.showDialog,"onUpdate:visible":a[3]||(a[3]=g=>e.showDialog=g),theme:"warning",header:e.dialogTitle>=3?t.$t("tool.first")+e.dialogTitle+t.$t("tool.firstTitle")+t.$t("tool.last"):t.$t("tool.first")+e.dialogTitle+t.$t("tool.firstTitle"),body:t.$t("tool.clearMessage"),onConfirm:$},null,8,["visible","header","body"])])}}});const Lt=L(pt,[["__scopeId","data-v-778749a5"]]);export{Lt as default};
